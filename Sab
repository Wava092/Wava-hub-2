--[[
    WAVA HUB ULTIMATE EDITION
    Enhanced ESP System Integrated
    Removed: Float, Auto Buy Items, Xray Vision
]]

if not game:IsLoaded() then
    game.Loaded:Wait()
end

-- // SERVICES //
local CoreGui = game:GetService("CoreGui")
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Lighting = game:GetService("Lighting")
local LocalPlayer = Players.LocalPlayer

-- // ENHANCED ESP SYSTEM //
local playersEspEnabled = false
local playerEspMap = {}
local lockEspEnabled = false
local lockEspMap = {}
local rarityEnabled = {
    Mythic = false,
    ["Brainrot God"] = false,
    Secret = false
}

-- Player ESP Functions
local function createPlayerEsp(plr)
    if not playersEspEnabled or plr == Players.LocalPlayer then return end
    
    local char = plr.Character
    if not char then return end
    
    local root = char:WaitForChild("HumanoidRootPart", 5)
    if not root then return end

    -- Remove existing ESP if any
    if playerEspMap[plr] then
        playerEspMap[plr]:Destroy()
        playerEspMap[plr] = nil
    end

    -- Create Billboard GUI for player name
    local bb = Instance.new("BillboardGui")
    bb.Name = "ESP_" .. plr.Name
    bb.AlwaysOnTop = true
    bb.Size = UDim2.new(0, 200, 0, 50)
    bb.StudsOffset = Vector3.new(0, 3, 0)
    bb.Adornee = root
    bb.Parent = CoreGui

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.Text = plr.DisplayName
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    label.TextStrokeTransparency = 0
    label.TextScaled = true
    label.Font = Enum.Font.GothamBold
    label.Parent = bb

    -- Create Highlight for better visibility
    local highlight = Instance.new("Highlight")
    highlight.Name = "PlayerHighlight"
    highlight.Adornee = char
    highlight.FillColor = Color3.fromRGB(0, 0, 0)
    highlight.FillTransparency = 0.7
    highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
    highlight.OutlineTransparency = 0
    highlight.Parent = char

    playerEspMap[plr] = bb
end

local function removePlayerEsp(plr)
    if playerEspMap[plr] then
        playerEspMap[plr]:Destroy()
        playerEspMap[plr] = nil
    end
    
    -- Remove highlight
    if plr.Character then
        local highlight = plr.Character:FindFirstChild("PlayerHighlight")
        if highlight then
            highlight:Destroy()
        end
    end
end

local function setPlayersEsp(enabled)
    playersEspEnabled = enabled
    if enabled then
        -- Add ESP for existing players
        for _, plr in ipairs(Players:GetPlayers()) do
            if plr ~= Players.LocalPlayer then
                createPlayerEsp(plr)
            end
        end
        
        -- Connect events for new players
        Players.PlayerAdded:Connect(function(plr)
            if plr ~= Players.LocalPlayer then
                createPlayerEsp(plr)
                plr.CharacterAdded:Connect(function()
                    task.wait(0.5)
                    createPlayerEsp(plr)
                end)
            end
        end)
        
        Players.PlayerRemoving:Connect(function(plr)
            removePlayerEsp(plr)
        end)
    else
        -- Remove all ESP
        for plr, gui in pairs(playerEspMap) do
            if gui then gui:Destroy() end
        end
        playerEspMap = {}
        
        -- Remove all highlights
        for _, plr in ipairs(Players:GetPlayers()) do
            if plr.Character then
                local highlight = plr.Character:FindFirstChild("PlayerHighlight")
                if highlight then
                    highlight:Destroy()
                end
            end
        end
    end
end

-- Lock ESP Functions
local function updateLockEsp()
    if not lockEspEnabled then
        for _, gui in pairs(lockEspMap) do
            if gui then gui:Destroy() end
        end
        lockEspMap = {}
        return
    end

    for _, plot in pairs(workspace.Plots:GetChildren()) do
        local remainingLabel = plot:FindFirstChild("Purchases", true)
            and plot.Purchases:FindFirstChild("PlotBlock", true)
            and plot.Purchases.PlotBlock.Main:FindFirstChild("BillboardGui", true)
            and plot.Purchases.PlotBlock.Main.BillboardGui:FindFirstChild("RemainingTime", true)

        if remainingLabel then
            local tagName = "LockTimeESP_" .. plot.Name
            local existing = plot:FindFirstChild(tagName)

            local unlocked = (remainingLabel.Text == "0s")
            local text = unlocked and "ðŸ”“ UNLOCKED" or ("ðŸ”’ " .. remainingLabel.Text)

            local color
            -- Check if this is player's plot
            local isMyPlot = false
            local yourBase = plot:FindFirstChild("YourBase", true)
            if yourBase and yourBase.Enabled then
                isMyPlot = true
            end

            if isMyPlot then
                color = unlocked and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 255, 0)
            else
                color = unlocked and Color3.fromRGB(220, 20, 60) or Color3.fromRGB(255, 255, 0)
            end

            if not existing then
                local bb = Instance.new("BillboardGui")
                bb.Name = tagName
                bb.Size = UDim2.new(0, 150, 0, 40)
                bb.StudsOffset = Vector3.new(0, 5, 0)
                bb.AlwaysOnTop = true
                bb.Adornee = plot.Purchases.PlotBlock.Main
                bb.Parent = plot

                local label = Instance.new("TextLabel")
                label.Text = text
                label.Size = UDim2.new(1, 0, 1, 0)
                label.BackgroundTransparency = 1
                label.TextScaled = true
                label.TextColor3 = color
                label.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
                label.TextStrokeTransparency = 0
                label.Font = Enum.Font.GothamBold
                label.Parent = bb

                lockEspMap[plot.Name] = bb
            else
                existing.TextLabel.Text = text
                existing.TextLabel.TextColor3 = color
            end
        elseif lockEspMap[plot.Name] then
            lockEspMap[plot.Name]:Destroy()
            lockEspMap[plot.Name] = nil
        end
    end
end

local function setLockESP(enabled)
    lockEspEnabled = enabled
    updateLockEsp()
end

-- Rarity ESP System
local rarityConfig = {
    Mythic = {
        Color = Color3.fromRGB(255, 215, 0),
        Size = UDim2.new(0, 120, 0, 40),
    },
    ["Brainrot God"] = {
        Color = Color3.fromRGB(138, 43, 226),
        Size = UDim2.new(0, 120, 0, 40),
    },
    Secret = {
        Color = Color3.fromRGB(220, 20, 60),
        Size = UDim2.new(0, 120, 0, 40),
    },
}

local mutationConfig = {
    Gold = {
        Color = Color3.fromRGB(255, 215, 0),
        Size = UDim2.new(0, 100, 0, 30),
    },
    Diamond = {
        Color = Color3.fromRGB(0, 191, 255),
        Size = UDim2.new(0, 100, 0, 30),
    },
    Rainbow = {
        Color = Color3.fromRGB(255, 0, 255),
        Size = UDim2.new(0, 100, 0, 30),
    },
    Bloodrot = {
        Color = Color3.fromRGB(139, 0, 0),
        Size = UDim2.new(0, 100, 0, 30),
    },
}

local function updateRarityMutationEsp()
    for _, plot in pairs(workspace.Plots:GetChildren()) do
        -- Skip player's own plot
        local yourBase = plot:FindFirstChild("YourBase", true)
        if not (yourBase and yourBase.Enabled) then
            for _, desc in pairs(plot:GetDescendants()) do
                if desc.Name == "Rarity" and desc:IsA("TextLabel") and rarityConfig[desc.Text] then
                    local parentModel = desc.Parent.Parent
                    local rarityTag = desc.Text .. "_ESP"
                    local mutationTag = "Mutation_ESP"

                    local rarityGui = parentModel:FindFirstChild(rarityTag)
                    local mutationGui = parentModel:FindFirstChild(mutationTag)

                    if rarityEnabled[desc.Text] then
                        if not rarityGui then
                            local cfg = rarityConfig[desc.Text]
                            local bb = Instance.new("BillboardGui")
                            bb.Name = rarityTag
                            bb.Size = cfg.Size
                            bb.StudsOffset = Vector3.new(0, 3, 0)
                            bb.AlwaysOnTop = true
                            bb.Adornee = parentModel
                            bb.Parent = parentModel

                            local label = Instance.new("TextLabel")
                            label.Text = desc.Parent.DisplayName.Text
                            label.Size = UDim2.new(1, 0, 1, 0)
                            label.BackgroundTransparency = 1
                            label.TextScaled = true
                            label.TextColor3 = cfg.Color
                            label.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
                            label.TextStrokeTransparency = 0
                            label.Font = Enum.Font.GothamBold
                            label.Parent = bb
                        end

                        -- Add mutation ESP if available
                        local mutationLabel = desc.Parent:FindFirstChild("Mutation")
                        if mutationLabel and mutationConfig[mutationLabel.Text] then
                            local cfg = mutationConfig[mutationLabel.Text]
                            if not mutationGui then
                                local bb = Instance.new("BillboardGui")
                                bb.Name = mutationTag
                                bb.Size = cfg.Size
                                bb.StudsOffset = Vector3.new(0, 6, 0)
                                bb.AlwaysOnTop = true
                                bb.Adornee = parentModel
                                bb.Parent = parentModel

                                local label = Instance.new("TextLabel")
                                label.Text = mutationLabel.Text
                                label.Size = UDim2.new(1, 0, 1, 0)
                                label.BackgroundTransparency = 1
                                label.TextScaled = true
                                label.TextColor3 = cfg.Color
                                label.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
                                label.TextStrokeTransparency = 0
                                label.Font = Enum.Font.GothamBold
                                label.Parent = bb
                            else
                                mutationGui.TextLabel.Text = mutationLabel.Text
                                mutationGui.TextLabel.TextColor3 = cfg.Color
                            end
                        elseif mutationGui then
                            mutationGui:Destroy()
                        end
                    else
                        if rarityGui then rarityGui:Destroy() end
                        if mutationGui then mutationGui:Destroy() end
                    end
                end
            end
        end
    end
end

-- ESP Update Loop
task.spawn(function()
    while true do
        task.wait(0.5)
        if lockEspEnabled then
            updateLockEsp()
        end
        if next(rarityEnabled) ~= nil then
            updateRarityMutationEsp()
        end
    end
end)

-- // NEW FUNCTIONS FROM BOTTOM SCRIPT //

-- Float System
local floatEnabled = false
local floatConn = nil
local baseY = nil

local function toggleFloat()
    floatEnabled = not floatEnabled
    if floatEnabled then
        local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
        local humanoid = char:FindFirstChildOfClass("Humanoid")
        local root = char:WaitForChild("HumanoidRootPart")

        baseY = root.Position.Y
        floatConn = RunService.Heartbeat:Connect(function()
            if not floatEnabled or not humanoid or not root or humanoid.Health <= 0 then
                if floatConn then
                    floatConn:Disconnect()
                    floatConn = nil
                end
                return
            end

            humanoid:ChangeState(Enum.HumanoidStateType.Flying)

            local cam = workspace.CurrentCamera
            local forward = cam and cam.CFrame.LookVector or Vector3.new(0, 0, -1)
            forward = Vector3.new(forward.X, 0, forward.Z)
            if forward.Magnitude > 0 then
                forward = forward.Unit
            end

            local pos = root.Position
            local targetY = baseY + 2.7
            if pos.Y < targetY then
                root.AssemblyLinearVelocity = forward * 40 + Vector3.new(0, math.min(40, (targetY - pos.Y) * 10), 0)
            else
                root.AssemblyLinearVelocity = forward * 40
                if math.abs(pos.Y - targetY) > 0.1 then
                    root.CFrame = CFrame.new(
                        pos.X, targetY, pos.Z,
                        root.CFrame:VectorToWorldSpace(Vector3.new(1, 0, 0)),
                        root.CFrame:VectorToWorldSpace(Vector3.new(0, 1, 0)),
                        root.CFrame:VectorToWorldSpace(Vector3.new(0, 0, 1))
                    )
                end
            end
        end)
    else
        if floatConn then
            floatConn:Disconnect()
            floatConn = nil
        end
        baseY = nil
        local char = LocalPlayer.Character
        if char then
            local humanoid = char:FindFirstChildOfClass("Humanoid")
            if humanoid then
                humanoid:ChangeState(Enum.HumanoidStateType.GettingUp)
            end
        end
    end
end

-- Enhanced Anti-Ragdoll System
local antiRagdollEnabled = false
local antiConnections = {}
local characterAddedConn = nil

local function watchInstance(inst)
    if inst:IsA("BasePart") then
        table.insert(antiConnections, inst:GetPropertyChangedSignal("Anchored"):Connect(function()
            if inst.Anchored and antiRagdollEnabled then
                inst.Anchored = false
            end
        end))
        table.insert(antiConnections, inst.ChildAdded:Connect(function(child)
            if child and (child:IsA("BallSocketConstraint") or child.Name == "Attachment" or child:IsA("HingeConstraint")) and child.Parent then
                child:Destroy()

                local char = LocalPlayer.Character
                if char and char:FindFirstChildOfClass("Humanoid") then
                    local hum = char.Humanoid
                    hum:ChangeState(Enum.HumanoidStateType.GettingUp)
                    hum.PlatformStand = false
                    workspace.CurrentCamera.CameraSubject = hum
                    char.HumanoidRootPart.CanCollide = true
                end

                local motor = inst:FindFirstChildWhichIsA("Motor6D")
                if motor then
                    motor.Enabled = true
                end

                -- Re-enable controls
                pcall(function()
                    require(LocalPlayer.PlayerScripts.PlayerModule.ControlModule):Enable()
                end)

                for _ = 1, 10 do
                    task.wait()
                    inst.Velocity = Vector3.new(0, 0, 0)
                end
            end
        end))
    elseif inst:IsA("Humanoid") then
        table.insert(antiConnections, inst.StateChanged:Connect(function()
            if antiRagdollEnabled and (inst:GetState() == Enum.HumanoidStateType.Physics or inst:GetState() == Enum.HumanoidStateType.Ragdoll) then
                inst:ChangeState(Enum.HumanoidStateType.GettingUp)
            end
        end))
    end
end

local function watchCharacter(char)
    if not char then return end
    for _, child in pairs(char:GetChildren()) do
        watchInstance(child)
    end
    table.insert(antiConnections, char.ChildAdded:Connect(watchInstance))
end

local function enableAntiRagdoll()
    if antiRagdollEnabled then return end
    antiRagdollEnabled = true
    
    if LocalPlayer.Character then
        watchCharacter(LocalPlayer.Character)
    end
    if characterAddedConn then characterAddedConn:Disconnect() end
    characterAddedConn = LocalPlayer.CharacterAdded:Connect(watchCharacter)
end

local function disableAntiRagdoll()
    antiRagdollEnabled = false
    for _, conn in pairs(antiConnections) do
        conn:Disconnect()
    end
    antiConnections = {}
    if characterAddedConn then
        characterAddedConn:Disconnect()
        characterAddedConn = nil
    end
end

-- Auto Steal Function
local function autoSteal()
    local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    local root = char:WaitForChild("HumanoidRootPart")
    local humanoid = char:FindFirstChildOfClass("Humanoid")

    local deliveryHitbox = nil
    for _, plot in pairs(workspace.Plots:GetChildren()) do
        local yourBase = plot:FindFirstChild("YourBase", true)
        if yourBase and yourBase.Enabled then
            deliveryHitbox = plot:FindFirstChild("DeliveryHitbox", true)
            break
        end
    end

    if deliveryHitbox and root and humanoid then
        local originalY = root.Position.Y
        root.CFrame = root.CFrame + Vector3.new(0, 200, 0)
        task.wait(2)
        local targetPos = Vector3.new(deliveryHitbox.Position.X, root.Position.Y, deliveryHitbox.Position.Z)
        local tw = TweenService:Create(
            root,
            TweenInfo.new(((targetPos - root.Position).Magnitude) / humanoid.WalkSpeed * 1.3, Enum.EasingStyle.Linear, Enum.EasingDirection.Out),
            {
                CFrame = CFrame.new(targetPos) * (root.CFrame - root.Position),
                Velocity = Vector3.new(0, 0, 0),
            }
        )
        tw:Play()
        tw.Completed:Wait()
        root.CFrame = CFrame.new(Vector3.new(root.Position.X, originalY, root.Position.Z))
    end
end

-- Hide Brainrot System
local hideBrainrotActive = false
local afkHideActive = false
local originalHRP 
local realHRP  
local originalHipHeight
local animTrack
local preSimConn

local function enableRigSwap()
    local character = LocalPlayer.Character
    if not character or character:FindFirstChildOfClass("Humanoid") == nil then return false end
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if humanoid.Health <= 0 then return false end

    originalHipHeight = humanoid.HipHeight
    realHRP = character:FindFirstChild("HumanoidRootPart")
    if not realHRP then return false end

    local temp = Instance.new("Model")
    temp.Parent = game
    character.Parent = temp

    originalHRP = realHRP:Clone()
    originalHRP.Parent = character

    realHRP.Parent = workspace.CurrentCamera
    originalHRP.CFrame = realHRP.CFrame
    character.PrimaryPart = originalHRP
    character.Parent = workspace

    for _, d in ipairs(character:GetDescendants()) do
        if d:IsA("Weld") or d:IsA("Motor6D") then
            if d.Part0 == realHRP then d.Part0 = originalHRP end
            if d.Part1 == realHRP then d.Part1 = originalHRP end
        end
    end

    temp:Destroy()

    local anim = Instance.new("Animation")
    anim.AnimationId = "http://www.roblox.com/asset/?id=18537363391"
    animTrack = (humanoid:FindFirstChild("Animator") or Instance.new("Animator", humanoid)):LoadAnimation(anim)
    animTrack:Play(0, 1, 0)
    anim:Destroy()
    animTrack.TimePosition = 0.7
    animTrack:AdjustSpeed(math.huge)

    preSimConn = RunService.PreSimulation:Connect(function()
        if LocalPlayer.Character and realHRP then
            local pp = LocalPlayer.Character.PrimaryPart
            if pp then
                realHRP.CFrame = (pp.CFrame - Vector3.new(0, humanoid.HipHeight + pp.Size.Y/2 - 1 + 0.09, 0)) * CFrame.Angles(math.rad(180), 0, 0)
                realHRP.Velocity = pp.Velocity
                realHRP.CanCollide = false
            end
        end
    end)

    return true
end

local function disableRigSwap()
    if animTrack then animTrack:Stop(); animTrack:Destroy(); animTrack = nil end
    if preSimConn then preSimConn:Disconnect(); preSimConn = nil end

    if realHRP then
        local character = LocalPlayer.Character
        if character then
            local temp = Instance.new("Model")
            temp.Parent = game
            character.Parent = temp

            realHRP.Parent = character
            character.PrimaryPart = realHRP
            character.Parent = workspace
            realHRP.CanCollide = true

            for _, d in ipairs(character:GetDescendants()) do
                if d:IsA("Weld") or d:IsA("Motor6D") then
                    if d.Part0 == originalHRP then d.Part0 = realHRP end
                    if d.Part1 == originalHRP then d.Part1 = realHRP end
                end
            end

            if originalHRP then
                local lastCFrame = originalHRP.CFrame
                originalHRP:Destroy()
                originalHRP = nil
                realHRP.CFrame = lastCFrame
            end

            if character:FindFirstChildOfClass("Humanoid") then
                character.Humanoid.HipHeight = originalHipHeight
            end
        end

        realHRP = nil
    end
end

-- Anti-Die System
local antiDieActive = false

local function enableAntiDie()
    if antiDieActive then return end
    antiDieActive = true

    local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if not humanoid then return end

    humanoid.BreakJointsOnDeath = false
    humanoid:SetStateEnabled(Enum.HumanoidStateType.Dead, false)

    humanoid:GetPropertyChangedSignal("Health"):Connect(function()
        if humanoid.Health <= 0 then
            humanoid.Health = humanoid.MaxHealth
        end
    end)

    humanoid.Died:Connect(function()
        task.wait()
        local replacement = Instance.new("Humanoid")
        replacement.Name = "ReplacedHumanoid"
        replacement.Parent = character
        workspace.CurrentCamera.CameraSubject = replacement
        humanoid:Destroy()
    end)
end

local function disableAntiDie()
    if not antiDieActive then return end
    antiDieActive = false
    local character = LocalPlayer.Character
    if character then
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        if humanoid then
            humanoid.BreakJointsOnDeath = true
            humanoid:SetStateEnabled(Enum.HumanoidStateType.Dead, true)
        end
    end
end

-- Float Platform System
local floatUpActive = false
local floatUpConn = nil

local function toggleFloatUp()
    floatUpActive = not floatUpActive
    if floatUpActive then
        local character = LocalPlayer.Character
        if not character then return end
        local hrp = character:FindFirstChild("HumanoidRootPart")
        if not hrp then return end

        local platform = Instance.new("Part")
        platform.Name = "WavaPlatform"
        platform.Size = Vector3.new(10, 1, 10)
        platform.Position = hrp.Position - Vector3.new(0, 3, 0)
        platform.Anchored = true
        platform.CanCollide = true
        platform.Material = Enum.Material.Neon
        platform.BrickColor = BrickColor.new("Really black")
        platform.Transparency = 0.4
        platform.Parent = workspace

        local topGui = Instance.new("SurfaceGui")
        topGui.Face = Enum.NormalId.Top
        topGui.AlwaysOnTop = true
        topGui.Parent = platform

        local topFrame = Instance.new("Frame")
        topFrame.Size = UDim2.new(1, 0, 1, 0)
        topFrame.BackgroundTransparency = 1
        topFrame.Parent = topGui

        local ring = Instance.new("UIStroke")
        ring.Thickness = 4
        ring.Color = Color3.new(1, 0, 0)
        ring.Parent = topFrame

        local hue = 0
        local step = 0.02
        local bob = 0.1

        floatUpConn = RunService.Heartbeat:Connect(function()
            if not platform or not platform.Parent then return end
            hue = (hue + step) % 1
            ring.Color = Color3.fromHSV(hue, 1, 1)

            local c = LocalPlayer.Character
            if c and c:FindFirstChild("HumanoidRootPart") then
                local hum = c:FindFirstChildOfClass("Humanoid")
                if hum then
                    local underPos = c.HumanoidRootPart.Position - Vector3.new(0, hum.HipHeight + 2, 0)
                    platform.Position = Vector3.new(underPos.X, (platform.Position + Vector3.new(0, bob, 0)).Y, underPos.Z)
                end
            end
        end)
    else
        if floatUpConn then floatUpConn:Disconnect(); floatUpConn = nil end
        local p = workspace:FindFirstChild("WavaPlatform")
        if p then p:Destroy() end
    end
end

-- Float Fall System
local floatFallActive = false
local floatFallConn = nil

local function toggleFloatFall()
    floatFallActive = not floatFallActive
    if floatFallActive then
        local character = LocalPlayer.Character
        if not character then return end
        local hum = character:FindFirstChildOfClass("Humanoid")
        local hrp = character:FindFirstChild("HumanoidRootPart")
        if hum and hrp then
            hum:ChangeState(Enum.HumanoidStateType.Jumping)
            floatFallConn = RunService.Heartbeat:Connect(function()
                if floatFallActive and hrp then
                    hrp.Velocity = Vector3.new(hrp.Velocity.X, 0, hrp.Velocity.Z)
                end
            end)
        end
    else
        if floatFallConn then floatFallConn:Disconnect(); floatFallConn = nil end
    end
end

-- Lock Timer Reminder
local lockReminderActive = false
local reminderThread = nil

local function toggleLockReminder()
    lockReminderActive = not lockReminderActive
    if lockReminderActive then
        local running = true
        reminderThread = task.spawn(function()
            while running do
                task.wait(25)
                if not running then break end
                local g = Instance.new("ScreenGui")
                g.ResetOnSpawn = false
                g.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
                g.Parent = CoreGui
                local f = Instance.new("Frame")
                f.Size = UDim2.new(0, 250, 0, 50)
                f.Position = UDim2.new(0, 10, 0, 10)
                f.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
                f.BorderSizePixel = 0
                f.Parent = g
                Instance.new("UICorner", f)
                local lbl = Instance.new("TextLabel")
                lbl.Size = UDim2.new(1, 0, 1, 0)
                lbl.Text = "REMINDER! LOCK UR BASE"
                lbl.TextColor3 = Color3.fromRGB(255, 255, 255)
                lbl.BackgroundTransparency = 1
                lbl.Font = Enum.Font.GothamBold
                lbl.TextSize = 14
                lbl.Parent = f
                task.wait(3)
                g:Destroy()
            end
        end)
    else
        if reminderThread then
            task.cancel(reminderThread)
            reminderThread = nil
        end
    end
end

-- Desync System
local function openDesyncGUI()
    local playerGui = LocalPlayer:WaitForChild("PlayerGui")
    local desyncGui = Instance.new("ScreenGui")
    desyncGui.Name = "WavaHubPremium"
    desyncGui.ResetOnSpawn = false
    desyncGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    desyncGui.Parent = playerGui

    local frame = Instance.new("Frame")
    frame.Name = "MainFrame"
    frame.Size = UDim2.new(0, 200, 0, 100)
    frame.Position = UDim2.new(1, -210, 0, 10)
    frame.BackgroundColor3 = Color3.fromRGB(5, 5, 5)
    frame.BorderSizePixel = 0
    frame.Active = true
    frame.Parent = desyncGui

    local corner = Instance.new("UICorner"); corner.CornerRadius = UDim.new(0, 16); corner.Parent = frame
    local stroke = Instance.new("UIStroke"); stroke.Color = Color3.fromRGB(50,50,50); stroke.Thickness = 1; stroke.Transparency = 0.2; stroke.Parent = frame

    local header2 = Instance.new("Frame")
    header2.Name = "Header"
    header2.Size = UDim2.new(1, 0, 0, 40)
    header2.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
    header2.BorderSizePixel = 0
    header2.Parent = frame
    local corner2 = Instance.new("UICorner"); corner2.CornerRadius = UDim.new(0, 16); corner2.Parent = header2

    local title2 = Instance.new("TextLabel")
    title2.Name = "TitleLabel"
    title2.Size = UDim2.new(1, -50, 1, 0)
    title2.Position = UDim2.new(0, 16, 0, 0)
    title2.BackgroundTransparency = 1
    title2.Text = "t.me/deltascriptt | WAVA HUB"
    title2.TextColor3 = Color3.fromRGB(255, 255, 255)
    title2.TextSize = 14
    title2.TextXAlignment = Enum.TextXAlignment.Left
    title2.Font = Enum.Font.GothamBold
    title2.Parent = header2

    local title2Shadow = Instance.new("TextLabel")
    title2Shadow.Size = UDim2.new(1, -50, 1, 0)
    title2Shadow.Position = UDim2.new(0, 17, 0, 1)
    title2Shadow.BackgroundTransparency = 1
    title2Shadow.TextColor3 = Color3.fromRGB(0, 0, 0)
    title2Shadow.TextTransparency = 0.7
    title2Shadow.Text = "t.me/deltascriptt | WAVA HUB"
    title2Shadow.Font = Enum.Font.GothamBold
    title2Shadow.TextSize = 14
    title2Shadow.TextXAlignment = Enum.TextXAlignment.Left
    title2Shadow.ZIndex = title2.ZIndex - 1
    title2Shadow.Parent = header2
    local title2Stroke = Instance.new("UIStroke"); title2Stroke.Color = Color3.fromRGB(0,0,0); title2Stroke.Transparency = 0.5; title2Stroke.Parent = title2

    local close2 = Instance.new("TextButton")
    close2.Name = "CloseButton"
    close2.Size = UDim2.new(0, 32, 0, 32)
    close2.Position = UDim2.new(1, -36, 0, 4)
    close2.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
    close2.BorderSizePixel = 0
    close2.Text = "X"
    close2.TextColor3 = Color3.fromRGB(255, 255, 255)
    close2.TextSize = 14
    close2.Font = Enum.Font.GothamBold
    close2.Parent = header2

    close2.MouseEnter:Connect(function()
        TweenService:Create(close2, TweenInfo.new(0.2, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
            BackgroundColor3 = Color3.fromRGB(255, 255, 255),
            TextColor3 = Color3.fromRGB(0, 0, 0),
            Size = UDim2.new(0, 34, 0, 34),
        }):Play()
    end)
    close2.MouseLeave:Connect(function()
        TweenService:Create(close2, TweenInfo.new(0.2, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
            BackgroundColor3 = Color3.fromRGB(15, 15, 15),
            TextColor3 = Color3.fromRGB(255, 255, 255),
            Size = UDim2.new(0, 32, 0, 32),
        }):Play()
    end)
    close2.MouseButton1Click:Connect(function()
        local tw = TweenService:Create(frame, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In), {
            Size = UDim2.new(0, 0, 0, 0),
            Position = UDim2.new(0.5, 0, 0.5, 0),
        })
        tw:Play()
        tw.Completed:Connect(function() desyncGui:Destroy() end)
    end)

    local content2 = Instance.new("Frame")
    content2.Name = "Content"
    content2.Size = UDim2.new(1, -24, 1, -48)
    content2.Position = UDim2.new(0, 12, 0, 44)
    content2.BackgroundTransparency = 1
    content2.Parent = frame

    local desyncBtn = Instance.new("TextButton")
    desyncBtn.Name = "DesyncButton"
    desyncBtn.Size = UDim2.new(1, 0, 0, 40)
    desyncBtn.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    desyncBtn.BorderSizePixel = 0
    desyncBtn.Text = ""
    desyncBtn.Parent = content2
    local desyncCorner = Instance.new("UICorner"); desyncCorner.CornerRadius = UDim.new(0, 12); desyncCorner.Parent = desyncBtn
    local desyncStroke = Instance.new("UIStroke"); desyncStroke.Color = Color3.fromRGB(50, 50, 50); desyncStroke.Thickness = 1; desyncStroke.Transparency = 0.7; desyncStroke.Parent = desyncBtn

    local inner = Instance.new("Frame")
    inner.Size = UDim2.new(1, -24, 1, 0)
    inner.Position = UDim2.new(0, 12, 0, 0)
    inner.BackgroundTransparency = 1
    inner.Parent = desyncBtn

    local btnLabel = Instance.new("TextLabel")
    btnLabel.Name = "ButtonLabel"
    btnLabel.Size = UDim2.new(1, -60, 1, 0)
    btnLabel.BackgroundTransparency = 1
    btnLabel.Text = "Wava Desync"
    btnLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    btnLabel.TextSize = 14
    btnLabel.TextXAlignment = Enum.TextXAlignment.Left
    btnLabel.Font = Enum.Font.GothamMedium
    btnLabel.Parent = inner

    local toggleSwitch = Instance.new("Frame")
    toggleSwitch.Name = "ToggleSwitch"
    toggleSwitch.Size = UDim2.new(0, 48, 0, 24)
    toggleSwitch.Position = UDim2.new(1, -48, 0.5, -12)
    toggleSwitch.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    toggleSwitch.BorderSizePixel = 0
    toggleSwitch.Parent = inner
    Instance.new("UICorner", toggleSwitch)

    local toggleKnob = Instance.new("Frame")
    toggleKnob.Name = "ToggleKnob"
    toggleKnob.Size = UDim2.new(0, 20, 0, 20)
    toggleKnob.Position = UDim2.new(0, 2, 0, 2)
    toggleKnob.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    toggleKnob.BorderSizePixel = 0
    toggleKnob.Parent = toggleSwitch
    Instance.new("UICorner", toggleKnob)

    local desyncOn = false
    local function updateToggle()
        if desyncOn then
            TweenService:Create(toggleSwitch, TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
                BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            }):Play()
            TweenService:Create(toggleKnob, TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
                Position = UDim2.new(1, -22, 0, 2),
                BackgroundColor3 = Color3.fromRGB(0, 0, 0)
            }):Play()
        else
            TweenService:Create(toggleSwitch, TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
                BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            }):Play()
            TweenService:Create(toggleKnob, TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
                Position = UDim2.new(0, 2, 0, 2),
                BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            }):Play()
        end
    end

    local function tryEnableDesync()
        local success = pcall(function()
            local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
            local backpack = LocalPlayer:WaitForChild("Backpack")
            local humanoid = character:WaitForChild("Humanoid")

            local equippedTool = character:FindFirstChildOfClass("Tool")
            if not equippedTool then
                warn("No equipped tool found. Desync requires an equipped tool; not auto-equipping.")
                return false
            end

            local packages = game:GetService("ReplicatedStorage"):FindFirstChild("Packages")
            local net = packages and packages:FindFirstChild("Net")
            local useItem = net and net:FindFirstChild("RE/UseItem")
            local qCloneTeleport = net and net:FindFirstChild("RE/QuantumCloner/OnTeleport")

            if setfflag then
                setfflag("WorldStepMax", "-9999999999")
            end

            task.wait(0.2)
            if useItem and useItem.FireServer then useItem:FireServer() end
            task.wait(1)
            if qCloneTeleport and qCloneTeleport.FireServer then qCloneTeleport:FireServer() end
            task.wait(2)
            if setfflag then setfflag("WorldStepMax", "-1") end
            return true
        end)
        return success
    end

    desyncBtn.MouseEnter:Connect(function()
        TweenService:Create(desyncStroke, TweenInfo.new(0.2, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
            Transparency = 0.3
        }):Play()
    end)
    desyncBtn.MouseLeave:Connect(function()
        TweenService:Create(desyncStroke, TweenInfo.new(0.2, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
            Transparency = 0.7
        }):Play()
    end)

    desyncBtn.MouseButton1Click:Connect(function()
        desyncOn = not desyncOn
        updateToggle()
        if desyncOn then
            if not tryEnableDesync() then
                desyncOn = false
                updateToggle()
            end
        else
            pcall(function()
                if setfflag then setfflag("WorldStepMax", "-1") end
            end)
        end
    end)

    frame.Size = UDim2.new(0, 0, 0, 0)
    frame.Position = UDim2.new(0.5, 0, 0.5, 0)
    TweenService:Create(frame, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
        Size = UDim2.new(0, 200, 0, 100),
        Position = UDim2.new(1, -210, 0, 10),
    }):Play()

    LocalPlayer.CharacterAdded:Connect(function()
        desyncOn = false
        updateToggle()
    end)
end

-- Hide Brainrot with Pulse
local hidePulseActive = false

local function toggleHideBrainrot()
    if not hideBrainrotActive then
        if enableRigSwap() then
            hideBrainrotActive = true
            hidePulseActive = true
            enableAntiDie()
            task.spawn(function()
                while hidePulseActive do
                    task.wait(2.75)
                    if not hidePulseActive then break end
                    disableRigSwap()
                    task.wait(0.85)
                    if not hidePulseActive then break end
                    if hideBrainrotActive then
                        enableRigSwap()
                    end
                end
            end)
        end
    else
        hidePulseActive = false
        disableRigSwap()
        hideBrainrotActive = false
        disableAntiDie()
    end
end

-- AFK Hide Brainrot
local function toggleAfkHide()
    if not afkHideActive then
        if enableRigSwap() then
            afkHideActive = true
            enableAntiDie()
        end
    else
        disableRigSwap()
        afkHideActive = false
        disableAntiDie()
    end
end

-- // CONFIG SYSTEM //
local CONFIG_FILE = "wava_hub_config.json"
local function canWriteFiles()
    return type(writefile) == "function" and type(readfile) == "function" and type(isfile) == "function"
end

local config = {
    SpeedBoost = false,
    BoostSpeedValue = 50,
    AntiTrap = false,
    InfiniteJump = false,
    PlayerESP = false,
    LockESP = false,
    MythicESP = false,
    BrainrotGodESP = false,
    SecretESP = false,
    ViewBaseTimers = false,
    SelectedJobId = nil,
    Theme = "Purple",
    Fly = false,
    FlyToAnimal = false,
    AutoLazer = false,
    WebSlinger = false,
    PlotESP = false,
    AntiNegative = false,
    SentryResizer = false,
    BestAnimalEsp = false,
    ThirdFloor = false,
    FlyToBase = false,
    ForcedIdle = false,
    AntiRagdoll = false,
    JumpBoost = false,
    -- New config options
    Float = false,
    HideBrainrot = false,
    AfkHide = false,
    FloatUp = false,
    FloatFall = false,
    LockReminder = false
}

local function loadConfig()
    if canWriteFiles() and isfile(CONFIG_FILE) then
        local ok, txt = pcall(readfile, CONFIG_FILE)
        if ok and txt then
            local decodeOk, data = pcall(function() return HttpService:JSONDecode(txt) end)
            if decodeOk and type(data) == "table" then
                for k,v in pairs(data) do config[k] = v end
            end
        end
    end
end

local function saveConfig()
    if canWriteFiles() then
        pcall(function()
            writefile(CONFIG_FILE, HttpService:JSONEncode(config))
        end)
    end
end

loadConfig()

-- // UTILS //
local function tryLoadURLToRun(url)
    local ok, err = pcall(function()
        local txt = game:HttpGet(url)
        local f = loadstring(txt)
        if f then pcall(f) end
    end)
    if not ok then warn("Failed to load:", url, err) end
end

-- // LOGIC VARIABLES //
local antiTrapEnabled = false
local antiTrapConn = nil
local plotTimers_Enabled = false
local plotTimers_RenderConnection = nil
local plotTimers_OriginalProperties = {}
local speedBoostEnabled = false
local speedConn = nil
local infiniteJumpEnabled = false
local jumpBoostEnabled = false
local jumpConn = nil
local godModeEnabled = false
local antiRagdollEnabled2 = false
local antiConnections = {}
local characterAddedConn = nil
local autoSlapEnabled = false

-- New variables
local flyEnabled = false
local flyToAnimalEnabled = false
local autoLazerEnabled = false
local webSlingerEnabled = false
local plotESPEnabled = false
local antiNegativeEnabled = false
local sentryResizerEnabled = false
local bestAnimalEspEnabled = false
local thirdFloorEnabled = false
local flyToBaseEnabled = false
local forcedIdleEnabled = false

-- Fly variables
local LocalFlying = false
local flyToggle = false
local LvName = "flyLinearVelocity"
local AoName = "flyAlignOrientation"
local controlModule = require(LocalPlayer.PlayerScripts.PlayerModule.ControlModule)

-- Boogie Float variables
local carpetActive = false
local liftForce = nil
local platformPart = nil
local carpetConnection = nil

-- Animal ESP variables
local bestAnimalESP = nil
local bestAnimalValue = 0
local lastBestAnimalId = nil

-- // UI LIBRARY //
local UI = {}
local UI_Elements = {}

local ThemeColors = {
    Purple = { Main = Color3.fromRGB(25, 25, 35), Accent = Color3.fromRGB(138, 43, 226), Text = Color3.fromRGB(255, 255, 255) },
    Pink = { Main = Color3.fromRGB(30, 20, 25), Accent = Color3.fromRGB(255, 105, 180), Text = Color3.fromRGB(255, 220, 240) },
    Red = { Main = Color3.fromRGB(30, 20, 20), Accent = Color3.fromRGB(220, 50, 50), Text = Color3.fromRGB(255, 200, 200) },
    Green = { Main = Color3.fromRGB(20, 30, 20), Accent = Color3.fromRGB(50, 200, 100), Text = Color3.fromRGB(200, 255, 200) },
    Black = { Main = Color3.fromRGB(15, 15, 15), Accent = Color3.fromRGB(80, 80, 80), Text = Color3.fromRGB(255, 255, 255) },
    White = { Main = Color3.fromRGB(240, 240, 240), Accent = Color3.fromRGB(50, 50, 50), Text = Color3.fromRGB(20, 20, 20) },
}

local CurrentTheme = ThemeColors[config.Theme] or ThemeColors.Purple

function UI:UpdateTheme(themeName)
    config.Theme = themeName
    saveConfig()
    CurrentTheme = ThemeColors[themeName]
    
    local info = TweenInfo.new(0.5)
    for _, el in pairs(UI_Elements) do
        if el.Type == "MainFrame" then TweenService:Create(el.Obj, info, {BackgroundColor3 = CurrentTheme.Main}):Play()
        elseif el.Type == "Sidebar" then TweenService:Create(el.Obj, info, {BackgroundColor3 = CurrentTheme.Main}):Play()
        elseif el.Type == "TabFrame" then TweenService:Create(el.Obj, info, {BackgroundColor3 = Color3.fromRGB(30, 30, 40)}):Play()
        elseif el.Type == "Accent" then TweenService:Create(el.Obj, info, {BackgroundColor3 = CurrentTheme.Accent}):Play()
        elseif el.Type == "Text" then TweenService:Create(el.Obj, info, {TextColor3 = CurrentTheme.Text}):Play()
        elseif el.Type == "ToggleOn" and el.State then TweenService:Create(el.Obj, info, {BackgroundColor3 = CurrentTheme.Accent}):Play()
        end
    end
end

-- UI Creation Code
function UI:CreateWindow(titleText)
    if CoreGui:FindFirstChild("WavaRemastered") then CoreGui.WavaRemastered:Destroy() end

    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "WavaRemastered"
    ScreenGui.Parent = CoreGui
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

    local MainFrame = Instance.new("Frame")
    MainFrame.Name = "MainFrame"
    MainFrame.Size = UDim2.new(0, 480, 0, 320)
    MainFrame.Position = UDim2.new(0.5, -240, 0.5, -160)
    MainFrame.BackgroundColor3 = CurrentTheme.Main
    MainFrame.BorderSizePixel = 0
    MainFrame.ClipsDescendants = true
    MainFrame.Parent = ScreenGui
    table.insert(UI_Elements, {Type = "MainFrame", Obj = MainFrame})

    local MainCorner = Instance.new("UICorner", MainFrame)
    MainCorner.CornerRadius = UDim.new(0, 10)
    
    -- Drag system
    local dragging, dragInput, dragStart, startPos
    local function update(input)
        local delta = input.Position - dragStart
        MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
    
    MainFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = MainFrame.Position
            TweenService:Create(MainFrame, TweenInfo.new(0.1), {Size = UDim2.new(0, 475, 0, 315)}):Play()
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                    TweenService:Create(MainFrame, TweenInfo.new(0.1), {Size = UDim2.new(0, 480, 0, 320)}):Play()
                end
            end)
        end
    end)
    
    MainFrame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            update(input)
        end
    end)

    -- Header with controls
    local Header = Instance.new("Frame")
    Header.Size = UDim2.new(1, 0, 0, 35)
    Header.BackgroundTransparency = 1
    Header.Parent = MainFrame

    local Title = Instance.new("TextLabel")
    Title.Text = titleText
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 16
    Title.TextColor3 = CurrentTheme.Text
    Title.Size = UDim2.new(1, -80, 1, 0)
    Title.Position = UDim2.new(0, 15, 0, 0)
    Title.BackgroundTransparency = 1
    Title.TextXAlignment = Enum.TextXAlignment.Left
    Title.Parent = Header
    table.insert(UI_Elements, {Type = "Text", Obj = Title})

    local ControlButtons = Instance.new("Frame")
    ControlButtons.Size = UDim2.new(0, 60, 1, 0)
    ControlButtons.Position = UDim2.new(1, -60, 0, 0)
    ControlButtons.BackgroundTransparency = 1
    ControlButtons.Parent = Header

    local MinimizeBtn = Instance.new("TextButton")
    MinimizeBtn.Size = UDim2.new(0, 25, 0, 25)
    MinimizeBtn.Position = UDim2.new(0, 5, 0.5, -12.5)
    MinimizeBtn.BackgroundTransparency = 1
    MinimizeBtn.Text = "_"
    MinimizeBtn.TextSize = 18
    MinimizeBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
    MinimizeBtn.Parent = ControlButtons

    local CloseBtn = Instance.new("TextButton")
    CloseBtn.Size = UDim2.new(0, 25, 0, 25)
    CloseBtn.Position = UDim2.new(1, -30, 0.5, -12.5)
    CloseBtn.BackgroundTransparency = 1
    CloseBtn.Text = "Ã—"
    CloseBtn.TextSize = 18
    CloseBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
    CloseBtn.Parent = ControlButtons

    -- Sidebar
    local Sidebar = Instance.new("ScrollingFrame")
    Sidebar.Size = UDim2.new(0, 120, 1, -45)
    Sidebar.Position = UDim2.new(0, 10, 0, 40)
    Sidebar.BackgroundColor3 = CurrentTheme.Main
    Sidebar.BackgroundTransparency = 0
    Sidebar.BorderSizePixel = 0
    Sidebar.ScrollBarThickness = 2
    Sidebar.Parent = MainFrame
    table.insert(UI_Elements, {Type = "Sidebar", Obj = Sidebar})

    local SidebarCorner = Instance.new("UICorner", Sidebar)
    SidebarCorner.CornerRadius = UDim.new(0, 6)

    local SidebarLayout = Instance.new("UIListLayout", Sidebar)
    SidebarLayout.Padding = UDim.new(0, 4)

    -- Content Area
    local ContentArea = Instance.new("Frame")
    ContentArea.Size = UDim2.new(1, -140, 1, -45)
    ContentArea.Position = UDim2.new(0, 135, 0, 40)
    ContentArea.BackgroundTransparency = 1
    ContentArea.Parent = MainFrame

    local Window = {
        ScreenGui = ScreenGui,
        MainFrame = MainFrame,
        Sidebar = Sidebar,
        ContentArea = ContentArea,
        Tabs = {},
        ActiveTab = nil,
        IsMinimized = false
    }

    -- Minimize functionality
    MinimizeBtn.MouseButton1Click:Connect(function()
        Window.IsMinimized = not Window.IsMinimized
        if Window.IsMinimized then
            TweenService:Create(MainFrame, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out), 
                {Size = UDim2.new(0, 480, 0, 35)}):Play()
            TweenService:Create(Sidebar, TweenInfo.new(0.3), {BackgroundTransparency = 1}):Play()
            TweenService:Create(ContentArea, TweenInfo.new(0.3), {BackgroundTransparency = 1}):Play()
            wait(0.2)
            Sidebar.Visible = false
            ContentArea.Visible = false
            MinimizeBtn.Text = "+"
        else
            Sidebar.Visible = true
            ContentArea.Visible = true
            TweenService:Create(MainFrame, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out), 
                {Size = UDim2.new(0, 480, 0, 320)}):Play()
            TweenService:Create(Sidebar, TweenInfo.new(0.3), {BackgroundTransparency = 0}):Play()
            TweenService:Create(ContentArea, TweenInfo.new(0.3), {BackgroundTransparency = 0}):Play()
            MinimizeBtn.Text = "_"
        end
    end)

    CloseBtn.MouseButton1Click:Connect(function() 
        TweenService:Create(MainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In), 
            {Size = UDim2.new(0, 480, 0, 0), Position = UDim2.new(0.5, -240, 0.5, 0)}):Play()
        wait(0.3)
        ScreenGui:Destroy() 
    end)

    -- Intro Animation
    MainFrame.Size = UDim2.new(0, 480, 0, 0)
    MainFrame.Position = UDim2.new(0.5, -240, 0.5, 0)
    local openTween = TweenService:Create(MainFrame, TweenInfo.new(0.7, Enum.EasingStyle.Exponential), 
        {Size = UDim2.new(0, 480, 0, 320), Position = UDim2.new(0.5, -240, 0.5, -160)})
    openTween:Play()

    function Window:Tab(name)
        local TabBtn = Instance.new("TextButton")
        TabBtn.Size = UDim2.new(1, -5, 0, 30)
        TabBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        TabBtn.BackgroundTransparency = 1
        TabBtn.Text = name
        TabBtn.TextColor3 = Color3.fromRGB(150, 150, 150)
        TabBtn.Font = Enum.Font.GothamMedium
        TabBtn.TextSize = 12
        TabBtn.Parent = Sidebar
        
        local TabCorner = Instance.new("UICorner", TabBtn)
        TabCorner.CornerRadius = UDim.new(0, 6)

        local TabFrame = Instance.new("ScrollingFrame")
        TabFrame.Size = UDim2.new(1, 0, 1, 0)
        TabFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
        TabFrame.BackgroundTransparency = 0
        TabFrame.BorderSizePixel = 0
        TabFrame.Visible = false
        TabFrame.ScrollBarThickness = 2
        TabFrame.Parent = ContentArea
        table.insert(UI_Elements, {Type = "TabFrame", Obj = TabFrame})
        
        local TabFrameCorner = Instance.new("UICorner", TabFrame)
        TabFrameCorner.CornerRadius = UDim.new(0, 6)
        
        local TabLayout = Instance.new("UIListLayout", TabFrame)
        TabLayout.Padding = UDim.new(0, 5)
        TabLayout.SortOrder = Enum.SortOrder.LayoutOrder

        local TabObj = {Frame = TabFrame, Btn = TabBtn}

        TabBtn.MouseEnter:Connect(function()
            if TabFrame.Visible == false then
                TweenService:Create(TabBtn, TweenInfo.new(0.2), {BackgroundTransparency = 0.9, TextColor3 = Color3.fromRGB(200, 200, 200)}):Play()
            end
        end)
        
        TabBtn.MouseLeave:Connect(function()
            if TabFrame.Visible == false then
                TweenService:Create(TabBtn, TweenInfo.new(0.2), {BackgroundTransparency = 1, TextColor3 = Color3.fromRGB(150, 150, 150)}):Play()
            end
        end)

        TabBtn.MouseButton1Click:Connect(function()
            for _, t in pairs(Window.Tabs) do
                t.Frame.Visible = false
                TweenService:Create(t.Btn, TweenInfo.new(0.3), {BackgroundTransparency = 1, TextColor3 = Color3.fromRGB(150, 150, 150)}):Play()
            end
            
            TweenService:Create(TabBtn, TweenInfo.new(0.3), {BackgroundTransparency = 0.8, TextColor3 = CurrentTheme.Accent}):Play()
            
            TabFrame.Visible = true
            TabFrame.BackgroundTransparency = 1
            TweenService:Create(TabFrame, TweenInfo.new(0.3), {BackgroundTransparency = 0}):Play()
            
            table.insert(UI_Elements, {Type = "Text", Obj = TabBtn})
        end)

        if #Window.Tabs == 0 then
            TabBtn.TextColor3 = CurrentTheme.Accent
            TabBtn.BackgroundTransparency = 0.8
            TabFrame.Visible = true
            TabFrame.BackgroundTransparency = 0
        end

        table.insert(Window.Tabs, TabObj)

        local Items = {}

        function Items:Button(text, callback)
            local Btn = Instance.new("TextButton")
            Btn.Size = UDim2.new(1, -5, 0, 32)
            Btn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            Btn.Text = text
            Btn.TextColor3 = Color3.fromRGB(255, 255, 255)
            Btn.Font = Enum.Font.Gotham
            Btn.TextSize = 11
            Btn.Parent = TabFrame
            
            local BtnCorner = Instance.new("UICorner", Btn)
            BtnCorner.CornerRadius = UDim.new(0, 6)

            Btn.BackgroundTransparency = 1
            Btn.TextTransparency = 1
            delay(#TabFrame:GetChildren() * 0.05, function()
                TweenService:Create(Btn, TweenInfo.new(0.3), {BackgroundTransparency = 0}):Play()
                TweenService:Create(Btn, TweenInfo.new(0.3), {TextTransparency = 0}):Play()
            end)

            Btn.MouseEnter:Connect(function() 
                TweenService:Create(Btn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(50, 50, 50), Size = UDim2.new(1, -2, 0, 32)}):Play() 
            end)
            Btn.MouseLeave:Connect(function() 
                TweenService:Create(Btn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(40, 40, 40), Size = UDim2.new(1, -5, 0, 32)}):Play() 
            end)
            
            Btn.MouseButton1Click:Connect(function()
                local ripple = Instance.new("Frame", Btn)
                ripple.BackgroundColor3 = Color3.new(1,1,1)
                ripple.BackgroundTransparency = 0.8
                ripple.Size = UDim2.new(0,0,0,0)
                ripple.Position = UDim2.new(0.5,0,0.5,0)
                ripple.AnchorPoint = Vector2.new(0.5,0.5)
                local c = Instance.new("UICorner", ripple); c.CornerRadius = UDim.new(1,0)
                TweenService:Create(ripple, TweenInfo.new(0.4), {Size = UDim2.new(1.2,0,1.5,0), BackgroundTransparency = 1}):Play()
                game.Debris:AddItem(ripple, 0.45)
                
                TweenService:Create(Btn, TweenInfo.new(0.1), {Size = UDim2.new(1, -8, 0, 30)}):Play()
                TweenService:Create(Btn, TweenInfo.new(0.1), {Size = UDim2.new(1, -5, 0, 32)}):Play()
                
                local glow = Instance.new("Frame", Btn)
                glow.BackgroundColor3 = CurrentTheme.Accent
                glow.BackgroundTransparency = 0.7
                glow.Size = UDim2.new(1, 0, 1, 0)
                glow.ZIndex = -1
                Instance.new("UICorner", glow).CornerRadius = UDim.new(0, 6)
                TweenService:Create(glow, TweenInfo.new(0.3), {BackgroundTransparency = 1}):Play()
                game.Debris:AddItem(glow, 0.35)
                
                callback()
            end)
        end

        function Items:Toggle(text, default, callback)
            local ToggleFrame = Instance.new("TextButton")
            ToggleFrame.Size = UDim2.new(1, -5, 0, 32)
            ToggleFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
            ToggleFrame.Text = ""
            ToggleFrame.AutoButtonColor = false
            ToggleFrame.Parent = TabFrame
            
            local TCorner = Instance.new("UICorner", ToggleFrame)
            TCorner.CornerRadius = UDim.new(0, 6)

            ToggleFrame.BackgroundTransparency = 1
            delay(#TabFrame:GetChildren() * 0.05, function()
                TweenService:Create(ToggleFrame, TweenInfo.new(0.3), {BackgroundTransparency = 0}):Play()
            end)

            local Label = Instance.new("TextLabel")
            Label.Size = UDim2.new(0.7, 0, 1, 0)
            Label.Position = UDim2.new(0, 10, 0, 0)
            Label.BackgroundTransparency = 1
            Label.Text = text
            Label.Font = Enum.Font.Gotham
            Label.TextColor3 = Color3.fromRGB(255, 255, 255)
            Label.TextXAlignment = Enum.TextXAlignment.Left
            Label.TextSize = 11
            Label.Parent = ToggleFrame

            local Indicator = Instance.new("Frame")
            Indicator.Size = UDim2.new(0, 36, 0, 18)
            Indicator.Position = UDim2.new(1, -46, 0.5, -9)
            Indicator.BackgroundColor3 = default and CurrentTheme.Accent or Color3.fromRGB(60, 60, 60)
            Indicator.Parent = ToggleFrame
            local ICorner = Instance.new("UICorner", Indicator); ICorner.CornerRadius = UDim.new(1, 0)

            local Circle = Instance.new("Frame")
            Circle.Size = UDim2.new(0, 14, 0, 14)
            Circle.Position = default and UDim2.new(1, -16, 0.5, -7) or UDim2.new(0, 2, 0.5, -7)
            Circle.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            Circle.Parent = Indicator
            local CCorner = Instance.new("UICorner", Circle); CCorner.CornerRadius = UDim.new(1, 0)

            local state = default
            local elRef = {Type = "ToggleOn", Obj = Indicator, State = state}
            table.insert(UI_Elements, elRef)

            ToggleFrame.MouseEnter:Connect(function()
                TweenService:Create(ToggleFrame, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(45, 45, 45)}):Play()
            end)
            ToggleFrame.MouseLeave:Connect(function()
                TweenService:Create(ToggleFrame, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(35, 35, 35)}):Play()
            end)

            ToggleFrame.MouseButton1Click:Connect(function()
                state = not state
                elRef.State = state
                
                if state then
                    TweenService:Create(Indicator, TweenInfo.new(0.2), {BackgroundColor3 = CurrentTheme.Accent}):Play()
                    TweenService:Create(Circle, TweenInfo.new(0.2, Enum.EasingStyle.Back, Enum.EasingDirection.Out), 
                        {Position = UDim2.new(1, -16, 0.5, -7)}):Play()
                    
                    local pulse = Indicator:Clone()
                    pulse.Parent = Indicator.Parent
                    pulse.BackgroundTransparency = 0.5
                    TweenService:Create(pulse, TweenInfo.new(0.3), {Size = UDim2.new(0, 42, 0, 21), BackgroundTransparency = 1}):Play()
                    game.Debris:AddItem(pulse, 0.35)
                else
                    TweenService:Create(Indicator, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(60, 60, 60)}):Play()
                    TweenService:Create(Circle, TweenInfo.new(0.2, Enum.EasingStyle.Back, Enum.EasingDirection.Out), 
                        {Position = UDim2.new(0, 2, 0.5, -7)}):Play()
                end
                
                TweenService:Create(ToggleFrame, TweenInfo.new(0.1), {Size = UDim2.new(1, -8, 0, 30)}):Play()
                TweenService:Create(ToggleFrame, TweenInfo.new(0.1), {Size = UDim2.new(1, -5, 0, 32)}):Play()
                
                callback(state)
            end)
        end
        
        function Items:Label(text)
            local Lbl = Instance.new("TextLabel")
            Lbl.Size = UDim2.new(1, -5, 0, 18)
            Lbl.BackgroundTransparency = 1
            Lbl.Text = text
            Lbl.TextColor3 = Color3.fromRGB(150, 150, 150)
            Lbl.Font = Enum.Font.GothamBold
            Lbl.TextSize = 10
            Lbl.Parent = TabFrame
            
            Lbl.TextTransparency = 1
            delay(#TabFrame:GetChildren() * 0.05, function()
                TweenService:Create(Lbl, TweenInfo.new(0.5), {TextTransparency = 0}):Play()
            end)
        end

        return Items
    end
    return Window
end

-- // FUNCTION IMPLEMENTATIONS //

-- Existing functions
local function enableAntiTrap()
    if antiTrapEnabled then return end
    antiTrapEnabled = true
    -- Anti-trap implementation
end

local function disableAntiTrap()
    antiTrapEnabled = false
    -- Anti-trap implementation
end

local function updateSpeedBoost(state)
    speedBoostEnabled = state
    config.SpeedBoost = state
    saveConfig()
    -- Speed boost implementation
end

local function updateJumpBoost(state)
    jumpBoostEnabled = state
    -- Jump boost implementation
end

-- New function handlers
local function toggleFly(state)
    flyEnabled = state
    config.Fly = state
    saveConfig()
end

local function toggleFlyToAnimal(state)
    flyToAnimalEnabled = state
    config.FlyToAnimal = state
    saveConfig()
end

local function toggleAutoLazer(state)
    autoLazerEnabled = state
    config.AutoLazer = state
    saveConfig()
end

local function toggleWebSlinger(state)
    webSlingerEnabled = state
    config.WebSlinger = state
    saveConfig()
end

local function toggleAntiNegative(state)
    antiNegativeEnabled = state
    config.AntiNegative = state
    saveConfig()
end

local function toggleSentryResizer(state)
    sentryResizerEnabled = state
    config.SentryResizer = state
    saveConfig()
end

local function toggleBestAnimalEsp(state)
    bestAnimalEspEnabled = state
    config.BestAnimalEsp = state
    saveConfig()
end

local function toggleThirdFloor(state)
    thirdFloorEnabled = state
    config.ThirdFloor = state
    saveConfig()
end

local function toggleFlyToBase(state)
    flyToBaseEnabled = state
    config.FlyToBase = state
    saveConfig()
end

local function toggleForcedIdle(state)
    forcedIdleEnabled = state
    config.ForcedIdle = state
    saveConfig()
end

local function toggleAntiRagdoll(state)
    antiRagdollEnabled2 = state
    config.AntiRagdoll = state
    saveConfig()
end

-- // BUILDING THE WINDOW //

local Win = UI:CreateWindow("WAVA HUB | Ultimate Edition")

-- TAB: Main
local Main = Win:Tab("Main")

Main:Label("Player Movement")
Main:Toggle("Speed Boost", config.SpeedBoost, function(s) updateSpeedBoost(s) end)
Main:Toggle("Infinite Jump", config.InfiniteJump, function(s) 
    infiniteJumpEnabled = s
    config.InfiniteJump = s
    saveConfig() 
end)
Main:Toggle("Jump Boost", config.JumpBoost, function(s) updateJumpBoost(s) end)
Main:Toggle("Float", config.Float, function(s) 
    config.Float = s
    saveConfig()
    if s then toggleFloat() else toggleFloat() end
end)

Main:Label("Flight Systems")
Main:Toggle("Fly (Grapple Hook)", config.Fly, function(s) toggleFly(s) end)
Main:Toggle("Fly to Best Animal", config.FlyToAnimal, function(s) toggleFlyToAnimal(s) end)
Main:Toggle("Fly to Base", config.FlyToBase, function(s) toggleFlyToBase(s) end)
Main:Toggle("3rd Floor (Boogie)", config.ThirdFloor, function(s) toggleThirdFloor(s) end)

Main:Label("Combat")
Main:Toggle("Auto Laser Cape", config.AutoLazer, function(s) toggleAutoLazer(s) end)
Main:Toggle("Web Slinger", config.WebSlinger, function(s) toggleWebSlinger(s) end)
Main:Toggle("Auto Slap", false, function(s) autoSlapEnabled = s end)

Main:Label("Actions")
Main:Button("Teleport UP (+150)", function() 
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        LocalPlayer.Character.HumanoidRootPart.CFrame += Vector3.new(0, 150, 0)
    end
end)
Main:Button("Teleport DOWN (-189)", function() 
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        LocalPlayer.Character.HumanoidRootPart.CFrame -= Vector3.new(0, 189, 0)
    end
end)
Main:Button("God Mode (Heal)", function() 
    godModeEnabled = not godModeEnabled 
end)
Main:Button("Auto Steal", function() autoSteal() end)
Main:Button("Wava Desync", function() openDesyncGUI() end)

Main:Label("Hide Systems")
Main:Toggle("Hide Brainrot", config.HideBrainrot, function(s)
    config.HideBrainrot = s
    saveConfig()
    toggleHideBrainrot()
end)
Main:Toggle("AFK Hide Brainrot", config.AfkHide, function(s)
    config.AfkHide = s
    saveConfig()
    toggleAfkHide()
end)
Main:Toggle("Float Up", config.FloatUp, function(s)
    config.FloatUp = s
    saveConfig()
    toggleFloatUp()
end)
Main:Toggle("Float Fall", config.FloatFall, function(s)
    config.FloatFall = s
    saveConfig()
    toggleFloatFall()
end)

-- TAB: Helper
local Helper = Win:Tab("Helper")

Helper:Label("Protection")
Helper:Toggle("Anti Trap", config.AntiTrap, function(s)
    config.AntiTrap = s; saveConfig()
    if s then enableAntiTrap() else disableAntiTrap() end
end)
Helper:Toggle("Anti Ragdoll", config.AntiRagdoll, function(s) 
    config.AntiRagdoll = s
    saveConfig()
    if s then enableAntiRagdoll() else disableAntiRagdoll() end
end)
Helper:Toggle("Anti Negative Effects", config.AntiNegative, function(s) toggleAntiNegative(s) end)

Helper:Label("Automation")
Helper:Toggle("Sentry Resizer", config.SentryResizer, function(s) toggleSentryResizer(s) end)
Helper:Toggle("Forced Idle", config.ForcedIdle, function(s) toggleForcedIdle(s) end)
Helper:Toggle("Lock Timer Reminder", config.LockReminder, function(s)
    config.LockReminder = s
    saveConfig()
    toggleLockReminder()
end)

-- TAB: ESP
local ESPTab = Win:Tab("ESP")

ESPTab:Label("Enhanced ESP System")
ESPTab:Toggle("Player ESP", config.PlayerESP, function(state)
    setPlayersEsp(state)
    config.PlayerESP = state
    saveConfig()
end)

ESPTab:Toggle("Lock/Unlock ESP", config.LockESP, function(state)
    setLockESP(state)
    config.LockESP = state
    saveConfig()
end)

ESPTab:Toggle("Mythic ESP", config.MythicESP or false, function(state)
    rarityEnabled.Mythic = state
    config.MythicESP = state
    saveConfig()
    updateRarityMutationEsp()
end)

ESPTab:Toggle("Brainrot God ESP", config.BrainrotGodESP or false, function(state)
    rarityEnabled["Brainrot God"] = state
    config.BrainrotGodESP = state
    saveConfig()
    updateRarityMutationEsp()
end)

ESPTab:Toggle("Secret ESP", config.SecretESP or false, function(state)
    rarityEnabled.Secret = state
    config.SecretESP = state
    saveConfig()
    updateRarityMutationEsp()
end)

ESPTab:Button("Clear All ESP", function()
    setPlayersEsp(false)
    setLockESP(false)
    for rarity in pairs(rarityEnabled) do
        rarityEnabled[rarity] = false
    end
    updateRarityMutationEsp()
    
    -- Update config
    config.PlayerESP = false
    config.LockESP = false
    config.MythicESP = false
    config.BrainrotGodESP = false
    config.SecretESP = false
    saveConfig()
end)

ESPTab:Label("Other Visuals")
ESPTab:Toggle("Best Animal ESP", config.BestAnimalEsp, function(s) toggleBestAnimalEsp(s) end)

-- TAB: Scripts
local Scripts = Win:Tab("Scripts")

Scripts:Label("Loaders")
Scripts:Button("Infinite Yield", function() tryLoadURLToRun("https://raw.githubusercontent.com/wedfwef3/ere.github.io/refs/heads/main/infyield.lua") end)
Scripts:Button("Steal Helper", function() tryLoadURLToRun("https://raw.githubusercontent.com/erewe23/uitest.github.io/refs/heads/main/ere.lua") end)
Scripts:Button("Anti-Steal (OP)", function() tryLoadURLToRun("https://raw.githubusercontent.com/34wefwef/antisteal.github.io/refs/heads/main/ere.lua") end)
Scripts:Button("Most Expensive ESP", function() tryLoadURLToRun("https://raw.githubusercontent.com/34t34t33/mostexpensive.github.io/refs/heads/main/rare.lua") end)

-- TAB: Other
local Other = Win:Tab("Other")

Other:Label("Server & Jobs")
Other:Button("Server Hop", function()
    -- Server hop implementation
end)
Other:Button("Rejoin", function() TeleportService:TeleportToPlaceInstance(game.PlaceId, game.JobId, LocalPlayer) end)

-- TAB: Themes
local Themes = Win:Tab("Themes")
Themes:Label("UI Colors")
Themes:Button("Purple Theme", function() UI:UpdateTheme("Purple") end)
Themes:Button("Red Theme", function() UI:UpdateTheme("Red") end)
Themes:Button("Green Theme", function() UI:UpdateTheme("Green") end)
Themes:Button("Pink Theme", function() UI:UpdateTheme("Pink") end)
Themes:Button("Black (OLED)", function() UI:UpdateTheme("Black") end)
Themes:Button("White (Flashbang)", function() UI:UpdateTheme("White") end)

-- // INITIALIZATION //

-- Initialize ESP based on config
if config.PlayerESP then
    setPlayersEsp(true)
end

if config.LockESP then
    setLockESP(true)
end

if config.MythicESP then
    rarityEnabled.Mythic = true
    updateRarityMutationEsp()
end

if config.BrainrotGodESP then
    rarityEnabled["Brainrot God"] = true
    updateRarityMutationEsp()
end

if config.SecretESP then
    rarityEnabled.Secret = true
    updateRarityMutationEsp()
end

-- Initialize other features based on config
if config.AntiTrap then enableAntiTrap() end
if config.SpeedBoost then updateSpeedBoost(true) end
if config.InfiniteJump then infiniteJumpEnabled = true end
if config.Fly then toggleFly(true) end
if config.AutoLazer then toggleAutoLazer(true) end
if config.BestAnimalEsp then toggleBestAnimalEsp(true) end
if config.ThirdFloor then toggleThirdFloor(true) end
if config.ForcedIdle then toggleForcedIdle(true) end
if config.AntiRagdoll then enableAntiRagdoll() end
if config.Float then toggleFloat() end
if config.HideBrainrot then toggleHideBrainrot() end
if config.AfkHide then toggleAfkHide() end
if config.FloatUp then toggleFloatUp() end
if config.FloatFall then toggleFloatFall() end
if config.LockReminder then toggleLockReminder() end

-- Character event handlers
LocalPlayer.CharacterAdded:Connect(function(char)
    if infiniteJumpEnabled then
        -- Initialize jump
    end
    
    if forcedIdleEnabled then
        -- Setup forced idle
    end
    
    if antiRagdollEnabled2 then
        -- Setup anti-ragdoll
    end
end)

-- Heartbeat loops
RunService.Heartbeat:Connect(function()
    -- God mode handler
    if godModeEnabled and LocalPlayer.Character then
        local h = LocalPlayer.Character:FindFirstChild("Humanoid")
        if h and h.Health < h.MaxHealth then h.Health = h.MaxHealth end
    end
end)

-- Infinite jump handler
UserInputService.JumpRequest:Connect(function()
    if infiniteJumpEnabled and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
        LocalPlayer.Character.Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
    end
end)

-- Auto slap handler
task.spawn(function()
    while true do
        task.wait(0.1)
        if autoSlapEnabled and LocalPlayer.Character then
            local r = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
            if r then
                for _, p in pairs(Players:GetPlayers()) do
                    if p ~= LocalPlayer and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
                        if (r.Position - p.Character.HumanoidRootPart.Position).Magnitude <= 10 then
                            local h = LocalPlayer.Character:FindFirstChild("Humanoid")
                            local slapToolNames = {"Tung Bat", "Blackhole Slap", "Dark Matter Slap", "Dev Slap", "Devil Slap", "Diamond Slap", "Emerald Slap", "Flame Slap", "Gold Slap", "Iron Slap", "Nuclear Slap", "Ruby Slap", "Slap"}
                            for _, t in pairs(slapToolNames) do
                                local tool = LocalPlayer.Backpack:FindFirstChild(t) or LocalPlayer.Character:FindFirstChild(t)
                                if tool then
                                    if tool.Parent ~= LocalPlayer.Character then h:EquipTool(tool) end
                                    tool:Activate()
                                end
                            end
                        end
                    end
                end
            end
        end
    end
end)

-- Anti-AFK
LocalPlayer.Idled:Connect(function()
    game:GetService("VirtualUser"):CaptureController()
    game:GetService("VirtualUser"):ClickButton2(Vector2.new())
end)

print("WAVA HUB Ultimate Edition Loaded - Enhanced ESP System Integrated!")
