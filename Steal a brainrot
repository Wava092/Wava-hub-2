if not game:IsLoaded() then
    game.Loaded:Wait()
end

local ok, initErr = pcall(function()
    local CoreGui = game:GetService("CoreGui")
    local Players = game:GetService("Players")
    local TweenService = game:GetService("TweenService")
    local RunService = game:GetService("RunService")
    local LocalPlayer = Players.LocalPlayer
    local UserInputService = game:GetService("UserInputService")
    local HttpService = game:GetService("HttpService")
    local TeleportService = game:GetService("TeleportService")

    -- Create data folder
    local dataFolder = "Qiwik"
    if not isfolder(dataFolder) then
        makefolder(dataFolder)
    end

    local function saveJson(fileName, tableData)
        writefile(dataFolder .. "/" .. fileName .. ".json", HttpService:JSONEncode(tableData))
    end

    local function readJson(fileName)
        local path = dataFolder .. "/" .. fileName .. ".json"
        if isfile(path) then
            local content = readfile(path)
            return HttpService:JSONDecode(content)
        end
        return nil
    end

    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "WavaHubGUI"
    screenGui.ResetOnSpawn = false
    screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    screenGui.Parent = CoreGui

    local mainFrame = Instance.new("Frame")
    mainFrame.Name = "MainFrame"
    mainFrame.Size = UDim2.new(0, 280, 0, 200)
    mainFrame.Position = UDim2.new(0.4, 0, 0.3, 0)
    mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    mainFrame.BorderSizePixel = 0
    mainFrame.Active = true
    mainFrame.Draggable = true
    mainFrame.Parent = screenGui
    Instance.new("UICorner", mainFrame)

    local header = Instance.new("Frame")
    header.Name = "Header"
    header.Size = UDim2.new(1, 0, 0, 40)
    header.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    header.BorderSizePixel = 0
    header.Parent = mainFrame
    Instance.new("UICorner", header)

    local title = Instance.new("TextLabel")
    title.Name = "TitleLabel"
    title.Size = UDim2.new(1, -40, 1, 0)
    title.Position = UDim2.new(0, 10, 0, 0)
    title.BackgroundTransparency = 1
    title.Text = "t.me/deltascriptt | WAVA HUB"
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.Font = Enum.Font.GothamBold
    title.TextSize = 12
    title.TextXAlignment = Enum.TextXAlignment.Left
    title.Parent = header

    local titleShadow = Instance.new("TextLabel")
    titleShadow.Size = UDim2.new(1, -40, 1, 0)
    titleShadow.Position = UDim2.new(0, 11, 0, 1)
    titleShadow.BackgroundTransparency = 1
    titleShadow.TextTransparency = 0.7
    titleShadow.Text = "t.me/deltascriptt | WAVA HUB"
    titleShadow.TextColor3 = Color3.fromRGB(0, 0, 0)
    titleShadow.Font = Enum.Font.GothamBold
    titleShadow.TextSize = 12
    titleShadow.TextXAlignment = Enum.TextXAlignment.Left
    titleShadow.ZIndex = title.ZIndex - 1
    titleShadow.Parent = header

    local titleStroke = Instance.new("UIStroke")
    titleStroke.Color = Color3.fromRGB(0, 0, 0)
    titleStroke.Thickness = 1
    titleStroke.Transparency = 0.5
    titleStroke.Parent = title

    local closeBtn = Instance.new("TextButton")
    closeBtn.Name = "CloseButton"
    closeBtn.Size = UDim2.new(0, 32, 0, 32)
    closeBtn.Position = UDim2.new(1, -36, 0, 4)
    closeBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    closeBtn.Text = "X"
    closeBtn.Font = Enum.Font.GothamBold
    closeBtn.TextSize = 14
    closeBtn.BorderSizePixel = 0
    closeBtn.Parent = header
    Instance.new("UICorner", closeBtn)

    local minimizeBtn = Instance.new("TextButton")
    minimizeBtn.Name = "MinimizeButton"
    minimizeBtn.Size = UDim2.new(0, 32, 0, 32)
    minimizeBtn.Position = UDim2.new(1, -74, 0, 4)
    minimizeBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    minimizeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    minimizeBtn.Text = "в–Ў"
    minimizeBtn.Font = Enum.Font.GothamBold
    minimizeBtn.TextSize = 14
    minimizeBtn.BorderSizePixel = 0
    minimizeBtn.Parent = header
    Instance.new("UICorner", minimizeBtn)

    local divider = Instance.new("Frame")
    divider.Size = UDim2.new(1, 0, 0, 1)
    divider.Position = UDim2.new(0, 0, 0, 40)
    divider.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    divider.BorderSizePixel = 0
    divider.ZIndex = 2
    divider.Parent = mainFrame

    local sidebar = Instance.new("Frame")
    sidebar.Name = "Sidebar"
    sidebar.Size = UDim2.new(0, 70, 1, -40)
    sidebar.Position = UDim2.new(0, 0, 0, 40)
    sidebar.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    sidebar.ZIndex = 1
    sidebar.Parent = mainFrame
    Instance.new("UICorner", sidebar)

    local function makeTabButton(text, y)
        local b = Instance.new("TextButton")
        b.Size = UDim2.new(0.8, 0, 0, 20)
        b.Position = UDim2.new(0.1, 0, 0.08, y)
        b.BackgroundColor3 = y == 0 and Color3.fromRGB(60, 60, 60) or Color3.fromRGB(40, 40, 40)
        b.TextColor3 = y == 0 and Color3.fromRGB(255, 255, 255) or Color3.fromRGB(180, 180, 180)
        b.Text = text
        b.Font = Enum.Font.Gotham
        b.TextSize = 10
        b.ZIndex = 2
        b.Parent = sidebar
        Instance.new("UICorner", b)
        return b
    end

    local tabMainBtn   = makeTabButton("Main",   0)
    local tabHelperBtn = makeTabButton("Helper", 25)
    local tabESPBtn    = makeTabButton("ESP",    50)
    local tabGUIsBtn   = makeTabButton("GUIS",   75)
    local tabThemesBtn = makeTabButton("Themes", 100)
    local tabOtherBtn  = makeTabButton("OTHER",  125)

    local content = Instance.new("Frame")
    content.Name = "Content"
    content.Size = UDim2.new(1, -75, 1, -45)
    content.Position = UDim2.new(0, 75, 0, 40)
    content.BackgroundTransparency = 1
    content.Parent = mainFrame

    -- Function to create scrolling frame for tabs
    local function createScrollFrame(parent)
        local scrollFrame = Instance.new("ScrollingFrame")
        scrollFrame.Size = UDim2.new(1, 0, 1, 0)
        scrollFrame.BackgroundTransparency = 1
        scrollFrame.BorderSizePixel = 0
        scrollFrame.ScrollBarThickness = 5
        scrollFrame.ScrollBarImageColor3 = Color3.fromRGB(100, 100, 100)
        scrollFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
        scrollFrame.Parent = parent
        
        local uiListLayout = Instance.new("UIListLayout")
        uiListLayout.Padding = UDim.new(0, 5)
        uiListLayout.SortOrder = Enum.SortOrder.LayoutOrder
        uiListLayout.Parent = scrollFrame
        
        return scrollFrame
    end

    -- Create tabs with scroll frames
    local tabMain   = Instance.new("Frame");   tabMain.Size = UDim2.new(1, 0, 1, 0);   tabMain.BackgroundTransparency = 1; tabMain.Visible = true;  tabMain.Parent = content
    local tabHelper = Instance.new("Frame"); tabHelper.Size = UDim2.new(1, 0, 1, 0); tabHelper.BackgroundTransparency = 1; tabHelper.Visible = false; tabHelper.Parent = content
    local tabESP    = Instance.new("Frame");    tabESP.Size = UDim2.new(1, 0, 1, 0);    tabESP.BackgroundTransparency = 1; tabESP.Visible = false;    tabESP.Parent = content
    local tabGUIs   = Instance.new("Frame");   tabGUIs.Size = UDim2.new(1, 0, 1, 0);   tabGUIs.BackgroundTransparency = 1; tabGUIs.Visible = false;   tabGUIs.Parent = content
    local tabThemes = Instance.new("Frame"); tabThemes.Size = UDim2.new(1, 0, 1, 0); tabThemes.BackgroundTransparency = 1; tabThemes.Visible = false; tabThemes.Parent = content
    local tabOther  = Instance.new("Frame");  tabOther.Size = UDim2.new(1, 0, 1, 0);  tabOther.BackgroundTransparency = 1; tabOther.Visible = false;  tabOther.Parent = content

    -- Create scroll frames for each tab
    local scrollMain = createScrollFrame(tabMain)
    local scrollHelper = createScrollFrame(tabHelper)
    local scrollESP = createScrollFrame(tabESP)
    local scrollGUIs = createScrollFrame(tabGUIs)
    local scrollThemes = createScrollFrame(tabThemes)
    local scrollOther = createScrollFrame(tabOther)

    local tabs = {
        Main = tabMain, Helper = tabHelper, ESP = tabESP, GUIS = tabGUIs, Themes = tabThemes, OTHER = tabOther
    }

    local function setActiveTab(name)
        for tabName, frame in pairs(tabs) do
            frame.Visible = (tabName == name)
        end
        tabMainBtn.BackgroundColor3   = (name == "Main")   and Color3.fromRGB(60,60,60) or Color3.fromRGB(40,40,40)
        tabHelperBtn.BackgroundColor3 = (name == "Helper") and Color3.fromRGB(60,60,60) or Color3.fromRGB(40,40,40)
        tabESPBtn.BackgroundColor3    = (name == "ESP")    and Color3.fromRGB(60,60,60) or Color3.fromRGB(40,40,40)
        tabGUIsBtn.BackgroundColor3   = (name == "GUIS")   and Color3.fromRGB(60,60,60) or Color3.fromRGB(40,40,40)
        tabThemesBtn.BackgroundColor3 = (name == "Themes") and Color3.fromRGB(60,60,60) or Color3.fromRGB(40,40,40)
        tabOtherBtn.BackgroundColor3  = (name == "OTHER")  and Color3.fromRGB(60,60,60) or Color3.fromRGB(40,40,40)
        tabMainBtn.TextColor3   = (name == "Main")   and Color3.fromRGB(255,255,255) or Color3.fromRGB(180,180,180)
        tabHelperBtn.TextColor3 = (name == "Helper") and Color3.fromRGB(255,255,255) or Color3.fromRGB(180,180,180)
        tabESPBtn.TextColor3    = (name == "ESP")    and Color3.fromRGB(255,255,255) or Color3.fromRGB(180,180,180)
        tabGUIsBtn.TextColor3   = (name == "GUIS")   and Color3.fromRGB(255,255,255) or Color3.fromRGB(180,180,180)
        tabThemesBtn.TextColor3 = (name == "Themes") and Color3.fromRGB(255,255,255) or Color3.fromRGB(180,180,180)
        tabOtherBtn.TextColor3  = (name == "OTHER")  and Color3.fromRGB(255,255,255) or Color3.fromRGB(180,180,180)
    end

    local function makeActionButton(parent, text)
        local b = Instance.new("TextButton")
        b.Size = UDim2.new(0, 160, 0, 32)
        b.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        b.TextColor3 = Color3.fromRGB(255, 255, 255)
        b.Text = text
        b.Font = Enum.Font.GothamBold
        b.TextSize = 12
        b.LayoutOrder = #parent:GetChildren()
        b.Parent = parent
        Instance.new("UICorner", b)
        return b
    end

    -- NEW FUNCTIONS FROM TOP SCRIPT
    local floatEnabled = false
    local floatConn = nil
    local baseY = nil

    local jumpBoostEnabled = false
    local jumpConn = nil

    local speedBoostEnabled = false
    local speedConn = nil

    local infiniteJumpEnabled = false

    local godModeEnabled = false

    local antiRagdollEnabled = false
    local antiConnections = {}
    local characterAddedConn = nil

    local autoSlapEnabled = false
    local autoSlapInterval = 0.1
    local slapToolNames = {
        "Tung Bat",
        "Blackhole Slap",
        "Dark Matter Slap",
        "Dev Slap",
        "Devil Slap",
        "Diamond Slap",
        "Emerald Slap",
        "Flame Slap",
        "Gold Slap",
        "Iron Slap",
        "Nuclear Slap",
        "Ruby Slap",
        "Slap",
    }

    local playersEspEnabled = false
    local playerEspMap = {}

    local lockEspEnabled = false
    local lockEspMap = {}

    local rarityEnabled = {
        Mythic = false,
        ["Brainrot God"] = false,
        Secret = false
    }

    -- ESP Configs
    local rarityConfig = {
        Mythic = {
            Color = Color3.fromRGB(255, 255, 255),
            Stroke = Color3.fromRGB(138, 43, 226),
            Size = UDim2.new(0, 100, 0, 40),
        },
        ["Brainrot God"] = {
            Color = Color3.fromRGB(255, 255, 255),
            Stroke = Color3.fromRGB(138, 43, 226),
            Size = UDim2.new(0, 100, 0, 40),
        },
        Secret = {
            Color = Color3.fromRGB(255, 255, 255),
            Stroke = Color3.fromRGB(138, 43, 226),
            Size = UDim2.new(0, 100, 0, 40),
        },
    }

    local mutationConfig = {
        Gold = {
            Color = Color3.fromRGB(255, 255, 255),
            Stroke = Color3.fromRGB(138, 43, 226),
            Size = UDim2.new(0, 100, 0, 40),
        },
        Diamond = {
            Color = Color3.fromRGB(255, 255, 255),
            Stroke = Color3.fromRGB(138, 43, 226),
            Size = UDim2.new(0, 100, 0, 40),
        },
        Rainbow = {
            Color = Color3.fromRGB(255, 255, 255),
            Stroke = Color3.fromRGB(138, 43, 226),
            Size = UDim2.new(0, 100, 0, 40),
        },
        Bloodrot = {
            Color = Color3.fromRGB(255, 255, 255),
            Stroke = Color3.fromRGB(138, 43, 226),
            Size = UDim2.new(0, 100, 0, 40),
        },
    }

    -- Main Tab - Existing buttons
    local btnHideBrainrot = makeActionButton(scrollMain, "HIDE BRAINROT")
    local btnDesync       = makeActionButton(scrollMain, "WAVA DESYNC")
    local btnFloatUp      = makeActionButton(scrollMain, "FLOAT UP")
    local btnFloatFall    = makeActionButton(scrollMain, "FLOAT FALL")

    -- Main Tab - NEW buttons from top script
    local btnFloat = makeActionButton(scrollMain, "FLOAT")
    local btnJumpBoost = makeActionButton(scrollMain, "JUMP BOOST")
    local btnSpeedBoost = makeActionButton(scrollMain, "SPEED BOOST")
    local btnInfinityJump = makeActionButton(scrollMain, "INFINITY JUMP")
    local btnGodMode = makeActionButton(scrollMain, "GOD MODE")
    local btnTeleportUp = makeActionButton(scrollMain, "TELEPORT UP")
    local btnTeleportDown = makeActionButton(scrollMain, "TELEPORT DOWN")
    local btnAutoSteal = makeActionButton(scrollMain, "AUTO STEAL")

    -- Helper Tab - Existing buttons
    local btnAfkHide      = makeActionButton(scrollHelper, "AFK HIDE BRAINROT")
    local btnAntiDie      = makeActionButton(scrollHelper, "ANTI-DIE")
    local btnLockReminder = makeActionButton(scrollHelper, "LOCK TIMER REMINDER"); btnLockReminder.TextSize = 10

    -- Helper Tab - NEW buttons from top script
    local btnAntiRagdoll = makeActionButton(scrollHelper, "ANTI-RAGDOLL")
    local btnAutoSlap = makeActionButton(scrollHelper, "AUTO-SLAP")

    -- ESP Tab
    local btnPlayerESP    = makeActionButton(scrollESP, "ESP PLAYER")

    -- ESP Tab - NEW buttons from top script
    local btnLockESP = makeActionButton(scrollESP, "LOCK ESP")
    local btnPlayersESP = makeActionButton(scrollESP, "PLAYERS ESP")
    local btnMythicESP = makeActionButton(scrollESP, "MYTHIC ESP")
    local btnBrainrotGodESP = makeActionButton(scrollESP, "BRAINROT GOD ESP")
    local btnSecretESP = makeActionButton(scrollESP, "SECRET ESP")

    -- GUIS Tab
    local guisTitle = Instance.new("TextLabel")
    guisTitle.Size = UDim2.new(1, 0, 0, 40)
    guisTitle.BackgroundTransparency = 1
    guisTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
    guisTitle.Text = "UPDATING SOON"
    guisTitle.Font = Enum.Font.GothamBold
    guisTitle.TextSize = 18
    guisTitle.LayoutOrder = 1
    guisTitle.Parent = scrollGUIs

    local guisSub = Instance.new("TextLabel")
    guisSub.Size = UDim2.new(1, 0, 0, 20)
    guisSub.BackgroundTransparency = 1
    guisSub.TextColor3 = Color3.fromRGB(180, 180, 180)
    guisSub.Text = "JOIN DISCORD"
    guisSub.Font = Enum.Font.Gotham
    guisSub.TextSize = 12
    guisSub.LayoutOrder = 2
    guisSub.Parent = scrollGUIs

    -- Themes Tab
    local themeButtons = {}
    
    local function createThemeButton(parent, text, themeColors)
        local btn = makeActionButton(parent, text)
        btn.TextSize = 11
        
        btn.MouseButton1Click:Connect(function()
            -- Apply theme colors
            mainFrame.BackgroundColor3 = themeColors.mainFrame
            header.BackgroundColor3 = themeColors.header
            sidebar.BackgroundColor3 = themeColors.sidebar
            title.TextColor3 = themeColors.text
            titleShadow.TextColor3 = Color3.fromRGB(0, 0, 0)
            divider.BackgroundColor3 = themeColors.divider
            
            -- Update active tab colors
            setActiveTab("Themes")
            
            -- Visual feedback
            TweenService:Create(btn, TweenInfo.new(0.2), {
                BackgroundColor3 = Color3.fromRGB(80, 80, 80)
            }):Play()
            wait(0.2)
            TweenService:Create(btn, TweenInfo.new(0.2), {
                BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            }):Play()
        end)
        
        table.insert(themeButtons, btn)
        return btn
    end

    -- Define themes
    local themes = {
        Purple = {
            mainFrame = Color3.fromRGB(40, 20, 60),
            header = Color3.fromRGB(60, 30, 90),
            sidebar = Color3.fromRGB(50, 25, 75),
            text = Color3.fromRGB(220, 180, 255),
            divider = Color3.fromRGB(100, 60, 140)
        },
        Pink = {
            mainFrame = Color3.fromRGB(60, 20, 50),
            header = Color3.fromRGB(90, 30, 70),
            sidebar = Color3.fromRGB(75, 25, 60),
            text = Color3.fromRGB(255, 180, 230),
            divider = Color3.fromRGB(140, 60, 110)
        },
        Black = {
            mainFrame = Color3.fromRGB(25, 25, 25),
            header = Color3.fromRGB(35, 35, 35),
            sidebar = Color3.fromRGB(30, 30, 30),
            text = Color3.fromRGB(255, 255, 255),
            divider = Color3.fromRGB(60, 60, 60)
        },
        White = {
            mainFrame = Color3.fromRGB(240, 240, 240),
            header = Color3.fromRGB(220, 220, 220),
            sidebar = Color3.fromRGB(230, 230, 230),
            text = Color3.fromRGB(30, 30, 30),
            divider = Color3.fromRGB(180, 180, 180)
        },
        Red = {
            mainFrame = Color3.fromRGB(60, 20, 20),
            header = Color3.fromRGB(90, 30, 30),
            sidebar = Color3.fromRGB(75, 25, 25),
            text = Color3.fromRGB(255, 180, 180),
            divider = Color3.fromRGB(140, 60, 60)
        },
        Green = {
            mainFrame = Color3.fromRGB(20, 60, 20),
            header = Color3.fromRGB(30, 90, 30),
            sidebar = Color3.fromRGB(25, 75, 25),
            text = Color3.fromRGB(180, 255, 180),
            divider = Color3.fromRGB(60, 140, 60)
        }
    }

    -- Create theme buttons
    createThemeButton(scrollThemes, "PURPLE THEME", themes.Purple)
    createThemeButton(scrollThemes, "PINK THEME", themes.Pink)
    createThemeButton(scrollThemes, "BLACK THEME", themes.Black)
    createThemeButton(scrollThemes, "WHITE THEME", themes.White)
    createThemeButton(scrollThemes, "RED THEME", themes.Red)
    createThemeButton(scrollThemes, "GREEN THEME", themes.Green)

    -- Other Tab
    local otherCredits = Instance.new("TextLabel")
    otherCredits.Size = UDim2.new(0, 160, 0, 32)
    otherCredits.BackgroundTransparency = 1
    otherCredits.TextColor3 = Color3.fromRGB(255, 255, 255)
    otherCredits.TextWrapped = true
    otherCredits.Text = "Brought to you by Wava Hub Team"
    otherCredits.Font = Enum.Font.GothamBold
    otherCredits.TextSize = 12
    otherCredits.LayoutOrder = 1
    otherCredits.Parent = scrollOther

    -- Other Tab - NEW buttons from top script
    local btnServerHop = makeActionButton(scrollOther, "SERVER HOP")
    local btnRejoin = makeActionButton(scrollOther, "REJOIN")

    local function wireButtonHover(b)
        local originalSize = b.Size
        b.MouseEnter:Connect(function()
            if not b.Text:find("%(ON%)") then
                TweenService:Create(b, TweenInfo.new(0.1), {
                    BackgroundColor3 = Color3.fromRGB(60, 60, 60),
                    Size = UDim2.new(0, 155, 0, 30),
                }):Play()
            end
        end)
        b.MouseLeave:Connect(function()
            local on = b.Text:find("%(ON%)")
            TweenService:Create(b, TweenInfo.new(0.1), {
                BackgroundColor3 = on and Color3.fromRGB(80, 20, 20) or Color3.fromRGB(40, 40, 40),
                Size = originalSize,
            }):Play()
        end)
        b.MouseButton1Down:Connect(function()
            TweenService:Create(b, TweenInfo.new(0.1), { Size = UDim2.new(0, 150, 0, 28) }):Play()
        end)
        b.MouseButton1Up:Connect(function()
            TweenService:Create(b, TweenInfo.new(0.1), { Size = originalSize }):Play()
        end)
    end

    -- Wire all buttons
    for _, b in ipairs({
        btnHideBrainrot, btnDesync, btnFloatUp, btnFloatFall,
        btnAfkHide, btnAntiDie, btnLockReminder, btnPlayerESP,
        btnFloat, btnJumpBoost, btnSpeedBoost, btnInfinityJump, btnGodMode,
        btnTeleportUp, btnTeleportDown, btnAutoSteal,
        btnAntiRagdoll, btnAutoSlap,
        btnLockESP, btnPlayersESP, btnMythicESP, btnBrainrotGodESP, btnSecretESP,
        btnServerHop, btnRejoin
    }) do
        wireButtonHover(b)
    end

    for _, btn in ipairs(themeButtons) do
        wireButtonHover(btn)
    end

    local function wireHeaderButtonHover(b)
        local originalSize = b.Size
        b.MouseEnter:Connect(function()
            TweenService:Create(b, TweenInfo.new(0.2, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
                BackgroundColor3 = Color3.fromRGB(255, 255, 255),
                TextColor3 = Color3.fromRGB(0, 0, 0),
                Size = UDim2.new(0, originalSize.X.Offset + 2, 0, originalSize.Y.Offset + 2),
            }):Play()
        end)
        b.MouseLeave:Connect(function()
            TweenService:Create(b, TweenInfo.new(0.2, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
                BackgroundColor3 = Color3.fromRGB(40, 40, 40),
                TextColor3 = Color3.fromRGB(255, 255, 255),
                Size = originalSize,
            }):Play()
        end)
    end

    wireHeaderButtonHover(closeBtn)
    wireHeaderButtonHover(minimizeBtn)

    tabMainBtn.MouseButton1Click:Connect(function() setActiveTab("Main") end)
    tabHelperBtn.MouseButton1Click:Connect(function() setActiveTab("Helper") end)
    tabESPBtn.MouseButton1Click:Connect(function() setActiveTab("ESP") end)
    tabGUIsBtn.MouseButton1Click:Connect(function() setActiveTab("GUIS") end)
    tabThemesBtn.MouseButton1Click:Connect(function() setActiveTab("Themes") end)
    tabOtherBtn.MouseButton1Click:Connect(function() setActiveTab("OTHER") end)

    -- NEW FUNCTION IMPLEMENTATIONS FROM TOP SCRIPT

    -- Float function
    btnFloat.MouseButton1Click:Connect(function()
        floatEnabled = not floatEnabled
        if floatEnabled then
            btnFloat.Text = "FLOAT (ON)"
            btnFloat.BackgroundColor3 = Color3.fromRGB(80, 20, 20)

            local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
            local humanoid = char:FindFirstChildOfClass("Humanoid")
            local root = char:WaitForChild("HumanoidRootPart")

            baseY = root.Position.Y
            floatConn = RunService.Heartbeat:Connect(function()
                if not floatEnabled or not humanoid or not root or humanoid.Health <= 0 then
                    if floatConn then
                        floatConn:Disconnect()
                        floatConn = nil
                    end
                    return
                end

                humanoid:ChangeState(Enum.HumanoidStateType.Flying)

                local cam = workspace.CurrentCamera
                local forward = cam and cam.CFrame.LookVector or Vector3.new(0, 0, -1)
                forward = Vector3.new(forward.X, 0, forward.Z)
                if forward.Magnitude > 0 then
                    forward = forward.Unit
                end

                local pos = root.Position
                local targetY = baseY + 2.7
                if pos.Y < targetY then
                    root.AssemblyLinearVelocity = forward * 40 + Vector3.new(0, math.min(40, (targetY - pos.Y) * 10), 0)
                else
                    root.AssemblyLinearVelocity = forward * 40
                    if math.abs(pos.Y - targetY) > 0.1 then
                        root.CFrame = CFrame.new(
                            pos.X, targetY, pos.Z,
                            root.CFrame:VectorToWorldSpace(Vector3.new(1, 0, 0)),
                            root.CFrame:VectorToWorldSpace(Vector3.new(0, 1, 0)),
                            root.CFrame:VectorToWorldSpace(Vector3.new(0, 0, 1))
                        )
                    end
                end
            end)
        else
            btnFloat.Text = "FLOAT"
            btnFloat.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            if floatConn then
                floatConn:Disconnect()
                floatConn = nil
            end
            baseY = nil
            if humanoid then
                humanoid:ChangeState(Enum.HumanoidStateType.GettingUp)
            end
        end
    end)

    -- Jump Boost function
    btnJumpBoost.MouseButton1Click:Connect(function()
        jumpBoostEnabled = not jumpBoostEnabled
        if jumpBoostEnabled then
            btnJumpBoost.Text = "JUMP BOOST (ON)"
            btnJumpBoost.BackgroundColor3 = Color3.fromRGB(80, 20, 20)

            local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
            local humanoid = char:FindFirstChildOfClass("Humanoid")
            local root = char:WaitForChild("HumanoidRootPart")

            if humanoid then
                humanoid.UseJumpPower = true
                humanoid.JumpPower = 96
            end
            if jumpConn then jumpConn:Disconnect() end
            jumpConn = RunService.Stepped:Connect(function()
                if not jumpBoostEnabled then
                    if jumpConn then jumpConn:Disconnect() jumpConn = nil end
                    if humanoid then humanoid.JumpPower = 50 end
                    return
                end
                if root and root.Velocity.Y < 0 then
                    root.Velocity = Vector3.new(root.Velocity.X, root.Velocity.Y * 0.9, root.Velocity.Z)
                end
            end)
        else
            btnJumpBoost.Text = "JUMP BOOST"
            btnJumpBoost.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            if jumpConn then jumpConn:Disconnect() jumpConn = nil end
            local char = LocalPlayer.Character
            if char then
                local humanoid = char:FindFirstChildOfClass("Humanoid")
                if humanoid then
                    humanoid.JumpPower = 50
                end
            end
        end
    end)

    -- Speed Boost function
    btnSpeedBoost.MouseButton1Click:Connect(function()
        speedBoostEnabled = not speedBoostEnabled
        if speedBoostEnabled then
            btnSpeedBoost.Text = "SPEED BOOST (ON)"
            btnSpeedBoost.BackgroundColor3 = Color3.fromRGB(80, 20, 20)

            local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
            local humanoid = char:FindFirstChildOfClass("Humanoid")
            local root = char:WaitForChild("HumanoidRootPart")

            if speedConn then speedConn:Disconnect() end
            speedConn = RunService.Heartbeat:Connect(function()
                if not speedBoostEnabled then
                    if speedConn then speedConn:Disconnect() speedConn = nil end
                    return
                end
                if humanoid and root and humanoid.MoveDirection.Magnitude > 0 then
                    local dir = humanoid.MoveDirection
                    root.Velocity = Vector3.new(dir.X * 50, root.Velocity.Y, dir.Z * 50)
                end
            end)
        elseif speedConn then
            speedConn:Disconnect()
            speedConn = nil
            btnSpeedBoost.Text = "SPEED BOOST"
            btnSpeedBoost.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        end
    end)

    -- Infinity Jump function
    btnInfinityJump.MouseButton1Click:Connect(function()
        infiniteJumpEnabled = not infiniteJumpEnabled
        if infiniteJumpEnabled then
            btnInfinityJump.Text = "INFINITY JUMP (ON)"
            btnInfinityJump.BackgroundColor3 = Color3.fromRGB(80, 20, 20)
        else
            btnInfinityJump.Text = "INFINITY JUMP"
            btnInfinityJump.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        end
    end)

    UserInputService.JumpRequest:Connect(function()
        if infiniteJumpEnabled then
            local humanoid = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
            if humanoid then
                humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
            end
        end
    end)

    -- God Mode function
    btnGodMode.MouseButton1Click:Connect(function()
        godModeEnabled = not godModeEnabled
        if godModeEnabled then
            btnGodMode.Text = "GOD MODE (ON)"
            btnGodMode.BackgroundColor3 = Color3.fromRGB(80, 20, 20)
        else
            btnGodMode.Text = "GOD MODE"
            btnGodMode.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        end
    end)

    RunService.RenderStepped:Connect(function()
        if godModeEnabled and LocalPlayer.Character then
            local humanoid = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
            if humanoid and humanoid.Health < humanoid.MaxHealth then
                humanoid.Health = humanoid.MaxHealth
                humanoid.PlatformStand = false
                humanoid.Sit = false
            end
        end
    end)

    -- Teleport Up function
    btnTeleportUp.MouseButton1Click:Connect(function()
        local root = (LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()):WaitForChild("HumanoidRootPart")
        if root then
            root.CFrame = root.CFrame + Vector3.new(0, 150, 0)
        end
    end)

    -- Teleport Down function
    btnTeleportDown.MouseButton1Click:Connect(function()
        local root = (LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()):WaitForChild("HumanoidRootPart")
        if root then
            root.CFrame = root.CFrame - Vector3.new(0, 189, 0)
        end
    end)

    -- Auto Steal function
    btnAutoSteal.MouseButton1Click:Connect(function()
        local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
        local root = char:WaitForChild("HumanoidRootPart")
        local humanoid = char:FindFirstChildOfClass("Humanoid")

        local deliveryHitbox = nil
        for _, plot in pairs(workspace.Plots:GetChildren()) do
            local yourBase = plot:FindFirstChild("YourBase", true)
            if yourBase and yourBase.Enabled then
                deliveryHitbox = plot:FindFirstChild("DeliveryHitbox", true)
                break
            end
        end

        if deliveryHitbox and root and humanoid then
            local originalY = root.Position.Y
            root.CFrame = root.CFrame + Vector3.new(0, 200, 0)
            task.wait(2)
            local targetPos = Vector3.new(deliveryHitbox.Position.X, root.Position.Y, deliveryHitbox.Position.Z)
            local tw = TweenService:Create(
                root,
                TweenInfo.new(((targetPos - root.Position).Magnitude) / humanoid.WalkSpeed * 1.3, Enum.EasingStyle.Linear, Enum.EasingDirection.Out),
                {
                    CFrame = CFrame.new(targetPos) * (root.CFrame - root.Position),
                    Velocity = Vector3.new(0, 0, 0),
                }
            )
            tw:Play()
            tw.Completed:Wait()
            root.CFrame = CFrame.new(Vector3.new(root.Position.X, originalY, root.Position.Z))
        end
    end)

    -- Anti-Ragdoll functions
    local function watchInstance(inst)
        if inst:IsA("BasePart") then
            table.insert(antiConnections, inst:GetPropertyChangedSignal("Anchored"):Connect(function()
                if inst.Anchored and antiRagdollEnabled then
                    inst.Anchored = false
                end
            end))
            table.insert(antiConnections, inst.ChildAdded:Connect(function(child)
                if child and (child:IsA("BallSocketConstraint") or child.Name == "Attachment" or child:IsA("HingeConstraint")) and child.Parent then
                    child:Destroy()

                    local char = LocalPlayer.Character
                    if char and char:FindFirstChildOfClass("Humanoid") then
                        local hum = char.Humanoid
                        hum:ChangeState(Enum.HumanoidStateType.GettingUp)
                        hum.PlatformStand = false
                        workspace.CurrentCamera.CameraSubject = hum
                        char.HumanoidRootPart.CanCollide = true
                    end

                    local motor = inst:FindFirstChildWhichIsA("Motor6D")
                    if motor then
                        motor.Enabled = true
                    end

                    -- Re-enable controls
                    pcall(function()
                        require(LocalPlayer.PlayerScripts.PlayerModule.ControlModule):Enable()
                    end)

                    for _ = 1, 10 do
                        task.wait()
                        inst.Velocity = Vector3.new(0, 0, 0)
                    end
                end
            end))
        elseif inst:IsA("Humanoid") then
            table.insert(antiConnections, inst.StateChanged:Connect(function()
                if antiRagdollEnabled and (inst:GetState() == Enum.HumanoidStateType.Physics or inst:GetState() == Enum.HumanoidStateType.Ragdoll) then
                    inst:ChangeState(Enum.HumanoidStateType.GettingUp)
                end
            end))
        end
    end

    local function watchCharacter(char)
        if not char then return end
        for _, child in pairs(char:GetChildren()) do
            watchInstance(child)
        end
        table.insert(antiConnections, char.ChildAdded:Connect(watchInstance))
    end

    btnAntiRagdoll.MouseButton1Click:Connect(function()
        antiRagdollEnabled = not antiRagdollEnabled
        if antiRagdollEnabled then
            btnAntiRagdoll.Text = "ANTI-RAGDOLL (ON)"
            btnAntiRagdoll.BackgroundColor3 = Color3.fromRGB(80, 20, 20)
            if LocalPlayer.Character then
                watchCharacter(LocalPlayer.Character)
            end
            if characterAddedConn then characterAddedConn:Disconnect() end
            characterAddedConn = LocalPlayer.CharacterAdded:Connect(watchCharacter)
        else
            btnAntiRagdoll.Text = "ANTI-RAGDOLL"
            btnAntiRagdoll.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            for _, conn in pairs(antiConnections) do
                conn:Disconnect()
            end
            antiConnections = {}
            if characterAddedConn then
                characterAddedConn:Disconnect()
                characterAddedConn = nil
            end
        end
    end)

    -- Auto-Slap function
    btnAutoSlap.MouseButton1Click:Connect(function()
        autoSlapEnabled = not autoSlapEnabled
        if autoSlapEnabled then
            btnAutoSlap.Text = "AUTO-SLAP (ON)"
            btnAutoSlap.BackgroundColor3 = Color3.fromRGB(80, 20, 20)
        else
            btnAutoSlap.Text = "AUTO-SLAP"
            btnAutoSlap.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        end
    end)

    task.spawn(function()
        while true do
            if autoSlapEnabled then
                local char = LocalPlayer.Character
                if char and char:FindFirstChild("HumanoidRootPart") then
                    local root = char.HumanoidRootPart
                    local humanoid = char:FindFirstChildOfClass("Humanoid")
                    if root and humanoid then
                        for _, plr in pairs(Players:GetPlayers()) do
                            if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
                                local otherRoot = plr.Character.HumanoidRootPart
                                if (root.Position - otherRoot.Position).Magnitude <= 10 then
                                    for _, toolName in pairs(slapToolNames) do
                                        local tool = LocalPlayer.Backpack:FindFirstChild(toolName) or LocalPlayer.Character:FindFirstChild(toolName)
                                        if tool then
                                            if not LocalPlayer.Character:FindFirstChild(toolName) then
                                                humanoid:EquipTool(tool)
                                                task.wait(0.1)
                                            end
                                            if tool:IsA("Tool") and tool.Parent == LocalPlayer.Character then
                                                tool:Activate()
                                            end
                                        end
                                    end
                                    break
                                end
                            end
                        end
                    end
                end
            end
            task.wait(autoSlapInterval)
        end
    end)

    -- ESP Functions
    local function createPlayerEsp(plr)
        if not playersEspEnabled or plr == Players.LocalPlayer then return end
        local char = plr.Character
        if not char then return end
        local root = char:WaitForChild("HumanoidRootPart", 5)
        if not root then return end

        if playerEspMap[plr] then
            playerEspMap[plr]:Destroy()
            playerEspMap[plr] = nil
        end

        local bb = Instance.new("BillboardGui")
        bb.Name = "ESP_" .. plr.Name
        bb.AlwaysOnTop = true
        bb.Size = UDim2.new(0, 100, 0, 40)
        bb.StudsOffset = Vector3.new(0, 3, 0)
        bb.Adornee = root
        bb.Parent = CoreGui

        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(1, 0, 1, 0)
        label.BackgroundTransparency = 1
        label.Text = plr.DisplayName
        label.TextColor3 = Color3.fromRGB(255, 255, 255)
        label.TextStrokeColor3 = Color3.fromRGB(138, 43, 226)
        label.TextStrokeTransparency = 0
        label.TextScaled = true
        label.Font = Enum.Font.GothamBold
        label.Parent = bb

        playerEspMap[plr] = bb
    end

    local function removePlayerEsp(plr)
        if playerEspMap[plr] then
            playerEspMap[plr]:Destroy()
            playerEspMap[plr] = nil
        end
    end

    local function setPlayersEsp(enabled)
        playersEspEnabled = enabled
        if enabled then
            for _, plr in ipairs(Players:GetPlayers()) do
                if plr ~= Players.LocalPlayer then
                    createPlayerEsp(plr)
                end
            end
        else
            for _, gui in pairs(playerEspMap) do
                if gui then gui:Destroy() end
            end
            playerEspMap = {}
        end
    end

    Players.PlayerAdded:Connect(function(plr)
        if playersEspEnabled and plr ~= Players.LocalPlayer then
            createPlayerEsp(plr)
            plr.CharacterAdded:Connect(function()
                task.wait(0.5)
                createPlayerEsp(plr)
            end)
        end
    end)

    Players.PlayerRemoving:Connect(removePlayerEsp)

    -- Lock ESP function
    local function updateLockEsp()
        if not lockEspEnabled then
            for _, gui in pairs(lockEspMap) do
                if gui then gui:Destroy() end
            end
            lockEspMap = {}
            return
        end

        for _, plot in pairs(workspace.Plots:GetChildren()) do
            local remainingLabel = plot:FindFirstChild("Purchases", true)
                and plot.Purchases:FindFirstChild("PlotBlock", true)
                and plot.Purchases.PlotBlock.Main:FindFirstChild("BillboardGui", true)
                and plot.Purchases.PlotBlock.Main.BillboardGui:FindFirstChild("RemainingTime", true)

            if remainingLabel then
                local tagName = "LockTimeESP_" .. plot.Name
                local existing = plot:FindFirstChild(tagName)

                local unlocked = (remainingLabel.Text == "0s")
                local text = unlocked and "Unlocked" or ("Lock: " .. remainingLabel.Text)

                local color
                if plot.Name == myPlotName then
                    color = unlocked and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 255, 0)
                else
                    color = unlocked and Color3.fromRGB(220, 20, 60) or Color3.fromRGB(255, 255, 0)
                end

                if not existing then
                    local bb = Instance.new("BillboardGui")
                    bb.Name = tagName
                    bb.Size = UDim2.new(0, 100, 0, 40)
                    bb.StudsOffset = Vector3.new(0, 5, 0)
                    bb.AlwaysOnTop = true
                    bb.Adornee = plot.Purchases.PlotBlock.Main
                    bb.Parent = plot

                    local label = Instance.new("TextLabel")
                    label.Text = text
                    label.Size = UDim2.new(1, 0, 1, 0)
                    label.BackgroundTransparency = 1
                    label.TextScaled = true
                    label.TextColor3 = color
                    label.TextStrokeColor3 = Color3.fromRGB(138, 43, 226)
                    label.TextStrokeTransparency = 0
                    label.Font = Enum.Font.GothamBold
                    label.Parent = bb

                    lockEspMap[plot.Name] = bb
                else
                    existing.TextLabel.Text = text
                    existing.TextLabel.TextColor3 = color
                end
            elseif lockEspMap[plot.Name] then
                lockEspMap[plot.Name]:Destroy()
                lockEspMap[plot.Name] = nil
            end
        end
    end

    local function updateRarityMutationEsp()
        for _, plot in pairs(workspace.Plots:GetChildren()) do
            if plot.Name ~= myPlotName then
                for _, desc in pairs(plot:GetDescendants()) do
                    if desc.Name == "Rarity" and desc:IsA("TextLabel") and rarityConfig[desc.Text] then
                        local parentModel = desc.Parent.Parent
                        local rarityTag = desc.Text .. "_ESP"
                        local mutationTag = "Mutation_ESP"

                        local rarityGui = parentModel:FindFirstChild(rarityTag)
                        local mutationGui = parentModel:FindFirstChild(mutationTag)

                        if rarityEnabled[desc.Text] then
                            if not rarityGui then
                                local cfg = rarityConfig[desc.Text]
                                local bb = Instance.new("BillboardGui")
                                bb.Name = rarityTag
                                bb.Size = cfg.Size
                                bb.StudsOffset = Vector3.new(0, 3, 0)
                                bb.AlwaysOnTop = true

                                local label = Instance.new("TextLabel")
                                label.Text = desc.Parent.DisplayName.Text
                                label.Size = UDim2.new(1, 0, 1, 0)
                                label.BackgroundTransparency = 1
                                label.TextScaled = true
                                label.TextColor3 = cfg.Color
                                label.TextStrokeColor3 = cfg.Stroke
                                label.TextStrokeTransparency = 0
                                label.Font = Enum.Font.GothamBold
                                label.Parent = bb

                                bb.Parent = parentModel
                            end

                            local mutationLabel = desc.Parent:FindFirstChild("Mutation")
                            if mutationLabel and mutationConfig[mutationLabel.Text] then
                                local cfg = mutationConfig[mutationLabel.Text]
                                if not mutationGui then
                                    local bb = Instance.new("BillboardGui")
                                    bb.Name = mutationTag
                                    bb.Size = cfg.Size
                                    bb.StudsOffset = Vector3.new(0, 6, 0)
                                    bb.AlwaysOnTop = true

                                    local label = Instance.new("TextLabel")
                                    label.Text = mutationLabel.Text
                                    label.Size = UDim2.new(1, 0, 1, 0)
                                    label.BackgroundTransparency = 1
                                    label.TextScaled = true
                                    label.TextColor3 = cfg.Color
                                    label.TextStrokeColor3 = cfg.Stroke
                                    label.TextStrokeTransparency = 0
                                    label.Font = Enum.Font.GothamBold
                                    label.Parent = bb

                                    bb.Parent = parentModel
                                else
                                    mutationGui.TextLabel.Text = mutationLabel.Text
                                    mutationGui.TextLabel.TextColor3 = cfg.Color
                                    mutationGui.TextLabel.TextStrokeColor3 = cfg.Stroke
                                end
                            elseif mutationGui then
                                mutationGui:Destroy()
                            end
                        else
                            if rarityGui then rarityGui:Destroy() end
                            if mutationGui then mutationGui:Destroy() end
                        end
                    end
                end
            end
        end
    end

    -- ESP Button handlers
    btnLockESP.MouseButton1Click:Connect(function()
        lockEspEnabled = not lockEspEnabled
        if lockEspEnabled then
            btnLockESP.Text = "LOCK ESP (ON)"
            btnLockESP.BackgroundColor3 = Color3.fromRGB(80, 20, 20)
            updateLockEsp()
        else
            btnLockESP.Text = "LOCK ESP"
            btnLockESP.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            updateLockEsp()
        end
    end)

    btnPlayersESP.MouseButton1Click:Connect(function()
        playersEspEnabled = not playersEspEnabled
        if playersEspEnabled then
            btnPlayersESP.Text = "PLAYERS ESP (ON)"
            btnPlayersESP.BackgroundColor3 = Color3.fromRGB(80, 20, 20)
            setPlayersEsp(true)
        else
            btnPlayersESP.Text = "PLAYERS ESP"
            btnPlayersESP.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            setPlayersEsp(false)
        end
    end)

    btnMythicESP.MouseButton1Click:Connect(function()
        rarityEnabled.Mythic = not rarityEnabled.Mythic
        if rarityEnabled.Mythic then
            btnMythicESP.Text = "MYTHIC ESP (ON)"
            btnMythicESP.BackgroundColor3 = Color3.fromRGB(80, 20, 20)
        else
            btnMythicESP.Text = "MYTHIC ESP"
            btnMythicESP.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        end
        updateRarityMutationEsp()
    end)

    btnBrainrotGodESP.MouseButton1Click:Connect(function()
        rarityEnabled["Brainrot God"] = not rarityEnabled["Brainrot God"]
        if rarityEnabled["Brainrot God"] then
            btnBrainrotGodESP.Text = "BRAINROT GOD ESP (ON)"
            btnBrainrotGodESP.BackgroundColor3 = Color3.fromRGB(80, 20, 20)
        else
            btnBrainrotGodESP.Text = "BRAINROT GOD ESP"
            btnBrainrotGodESP.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        end
        updateRarityMutationEsp()
    end)

    btnSecretESP.MouseButton1Click:Connect(function()
        rarityEnabled.Secret = not rarityEnabled.Secret
        if rarityEnabled.Secret then
            btnSecretESP.Text = "SECRET ESP (ON)"
            btnSecretESP.BackgroundColor3 = Color3.fromRGB(80, 20, 20)
        else
            btnSecretESP.Text = "SECRET ESP"
            btnSecretESP.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        end
        updateRarityMutationEsp()
    end)

    -- Server Hop function
    btnServerHop.MouseButton1Click:Connect(function()
        local placeId = game.PlaceId
        local seenServers = {}
        local cursor = ""
        local currentHour = os.date("!*t").hour

        if not pcall(function()
            seenServers = HttpService:JSONDecode(readfile("NotSameServers.json"))
        end) then
            table.insert(seenServers, currentHour)
            writefile("NotSameServers.json", HttpService:JSONEncode(seenServers))
        end

        local function scanPage()
            local page
            if cursor == "" then
                page = HttpService:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/" .. placeId .. "/servers/Public?sortOrder=Asc&limit=100"))
            else
                page = HttpService:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/" .. placeId .. "/servers/Public?sortOrder=Asc&limit=100&cursor=" .. cursor))
            end

            if page.nextPageCursor and page.nextPageCursor ~= "null" then
                cursor = page.nextPageCursor
            end

            for _, server in pairs(page.data) do
                local candidateId = tostring(server.id)
                local canJoin = tonumber(server.playing) < tonumber(server.maxPlayers)
                if canJoin then
                    local unique = true
                    for _, prev in ipairs(seenServers) do
                        if candidateId == tostring(prev) then
                            unique = false
                            break
                        end
                    end
                    if unique then
                        table.insert(seenServers, candidateId)
                        task.wait()
                        writefile("NotSameServers.json", HttpService:JSONEncode(seenServers))
                        TeleportService:TeleportToPlaceInstance(placeId, candidateId, LocalPlayer)
                        task.wait(4)
                        return
                    end
                end
            end
        end

        task.spawn(function()
            while task.wait() do
                scanPage()
                if cursor ~= "" then
                    scanPage()
                end
            end
        end)
    end)

    -- Rejoin function
    btnRejoin.MouseButton1Click:Connect(function()
        TeleportService:TeleportToPlaceInstance(game.PlaceId, game.JobId, LocalPlayer)
    end)

    -- ESP update loop
    task.spawn(function()
        while true do
            task.wait(0.25)
            if lockEspEnabled then
                updateLockEsp()
            end
            if next(rarityEnabled) ~= nil then
                updateRarityMutationEsp()
            end
        end
    end)

    -- Anti-AFK
    LocalPlayer.Idled:Connect(function()
        game:GetService("VirtualUser"):CaptureController()
        game:GetService("VirtualUser"):ClickButton2(Vector2.new())
    end)

    -- Rest of the existing functionality remains the same...
    local hideBrainrotActive = false
    local afkHideActive = false
    local floatUpActive = false
    local floatFallActive = false
    local antiDieActive = false
    local espActive = false
    local lockReminderActive = false

    local originalHRP 
    local realHRP  
    local originalHipHeight
    local animTrack
    local preSimConn
    local floatUpConn
    local floatFallConn
    local reminderThread

    local function enableRigSwap()
        local character = LocalPlayer.Character
        if not character or character:FindFirstChildOfClass("Humanoid") == nil then return false end
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        if humanoid.Health <= 0 then return false end

        originalHipHeight = humanoid.HipHeight
        realHRP = character:FindFirstChild("HumanoidRootPart")
        if not realHRP then return false end

        local temp = Instance.new("Model")
        temp.Parent = game
        character.Parent = temp

        originalHRP = realHRP:Clone()
        originalHRP.Parent = character

        realHRP.Parent = workspace.CurrentCamera
        originalHRP.CFrame = realHRP.CFrame
        character.PrimaryPart = originalHRP
        character.Parent = workspace

        for _, d in ipairs(character:GetDescendants()) do
            if d:IsA("Weld") or d:IsA("Motor6D") then
                if d.Part0 == realHRP then d.Part0 = originalHRP end
                if d.Part1 == realHRP then d.Part1 = originalHRP end
            end
        end

        temp:Destroy()

        local anim = Instance.new("Animation")
        anim.AnimationId = "http://www.roblox.com/asset/?id=18537363391"
        animTrack = (humanoid:FindFirstChild("Animator") or Instance.new("Animator", humanoid)):LoadAnimation(anim)
        animTrack:Play(0, 1, 0)
        anim:Destroy()
        animTrack.TimePosition = 0.7
        animTrack:AdjustSpeed(math.huge)

        preSimConn = RunService.PreSimulation:Connect(function()
            if LocalPlayer.Character and realHRP then
                local pp = LocalPlayer.Character.PrimaryPart
                if pp then
                    realHRP.CFrame = (pp.CFrame - Vector3.new(0, humanoid.HipHeight + pp.Size.Y/2 - 1 + 0.09, 0)) * CFrame.Angles(math.rad(180), 0, 0)
                    realHRP.Velocity = pp.Velocity
                    realHRP.CanCollide = false
                end
            end
        end)

        return true
    end

    local function disableRigSwap()
        if animTrack then animTrack:Stop(); animTrack:Destroy(); animTrack = nil end
        if preSimConn then preSimConn:Disconnect(); preSimConn = nil end

        if realHRP then
            local character = LocalPlayer.Character
            if character then
                local temp = Instance.new("Model")
                temp.Parent = game
                character.Parent = temp

                realHRP.Parent = character
                character.PrimaryPart = realHRP
                character.Parent = workspace
                realHRP.CanCollide = true

                for _, d in ipairs(character:GetDescendants()) do
                    if d:IsA("Weld") or d:IsA("Motor6D") then
                        if d.Part0 == originalHRP then d.Part0 = realHRP end
                        if d.Part1 == originalHRP then d.Part1 = realHRP end
                    end
                end

                if originalHRP then
                    local lastCFrame = originalHRP.CFrame
                    originalHRP:Destroy()
                    originalHRP = nil
                    realHRP.CFrame = lastCFrame
                end

                if character:FindFirstChildOfClass("Humanoid") then
                    character.Humanoid.HipHeight = originalHipHeight
                end
            end

            realHRP = nil
        end
    end

    local espObjects = {}
    local espConns = {}

    local function toggleESP()
        espActive = not espActive
        if espActive then
            btnPlayerESP.Text = "ESP PLAYER (ON)"
            btnPlayerESP.BackgroundColor3 = Color3.fromRGB(80, 20, 20)

            for _, plr in ipairs(Players:GetPlayers()) do
                if plr ~= LocalPlayer and plr.Character then
                    local hi = Instance.new("Highlight")
                    hi.Adornee = plr.Character
                    hi.FillColor = Color3.fromRGB(0, 0, 0)
                    hi.FillTransparency = 0.3
                    hi.OutlineColor = Color3.fromRGB(128, 128, 128)
                    hi.OutlineTransparency = 0
                    hi.Parent = plr.Character

                    local head = plr.Character:FindFirstChild("Head")
                    local bb = Instance.new("BillboardGui")
                    bb.Name = "ESPName"
                    bb.Adornee = head
                    bb.Size = UDim2.new(0, 100, 0, 30)
                    bb.StudsOffset = Vector3.new(0, 2, 0)
                    bb.AlwaysOnTop = true
                    bb.MaxDistance = 100
                    bb.Parent = plr.Character

                    local lbl = Instance.new("TextLabel")
                    lbl.Size = UDim2.new(1, 0, 1, 0)
                    lbl.BackgroundTransparency = 1
                    lbl.Text = plr.Name
                    lbl.TextColor3 = Color3.fromRGB(255, 255, 255)
                    lbl.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
                    lbl.TextStrokeTransparency = 0.5
                    lbl.Font = Enum.Font.GothamBold
                    lbl.TextScaled = true
                    lbl.Parent = bb

                    espObjects[plr] = { Highlight = hi, BillboardGui = bb }
                end
            end

            espConns.PlayerAdded = Players.PlayerAdded:Connect(function(plr)
                if plr == LocalPlayer then return end
                plr.CharacterAdded:Connect(function(char)
                    if not espActive then return end
                    local hi = Instance.new("Highlight")
                    hi.Adornee = char
                    hi.FillColor = Color3.fromRGB(0, 0, 0)
                    hi.FillTransparency = 0.3
                    hi.OutlineColor = Color3.fromRGB(128, 128, 128)
                    hi.OutlineTransparency = 0
                    hi.Parent = char

                    local head = char:FindFirstChild("Head")
                    local bb = Instance.new("BillboardGui")
                    bb.Name = "ESPName"
                    bb.Adornee = head
                    bb.Size = UDim2.new(0, 100, 0, 30)
                    bb.StudsOffset = Vector3.new(0, 2, 0)
                    bb.AlwaysOnTop = true
                    bb.MaxDistance = 100
                    bb.Parent = char

                    local lbl = Instance.new("TextLabel")
                    lbl.Size = UDim2.new(1, 0, 1, 0)
                    lbl.BackgroundTransparency = 1
                    lbl.Text = plr.Name
                    lbl.TextColor3 = Color3.fromRGB(255, 255, 255)
                    lbl.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
                    lbl.TextStrokeTransparency = 0.5
                    lbl.Font = Enum.Font.GothamBold
                    lbl.TextScaled = true
                    lbl.Parent = bb

                    espObjects[plr] = { Highlight = hi, BillboardGui = bb }
                end)
            end)

            espConns.PlayerRemoving = Players.PlayerRemoving:Connect(function(plr)
                local obj = espObjects[plr]
                if obj then
                    if obj.Highlight then obj.Highlight:Destroy() end
                    if obj.BillboardGui then obj.BillboardGui:Destroy() end
                    espObjects[plr] = nil
                end
            end)
        else
            btnPlayerESP.Text = "ESP PLAYER"
            btnPlayerESP.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            for plr, obj in pairs(espObjects) do
                if obj.Highlight then obj.Highlight:Destroy() end
                if obj.BillboardGui then obj.BillboardGui:Destroy() end
                espObjects[plr] = nil
            end
            for _, c in pairs(espConns) do c:Disconnect() end
            espConns = {}
        end
    end

    local function enableAntiDie()
        if antiDieActive then return end
        antiDieActive = true
        btnAntiDie.Text = "ANTI-DIE (ON)"
        btnAntiDie.BackgroundColor3 = Color3.fromRGB(80, 20, 20)

        local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        if not humanoid then return end

        humanoid.BreakJointsOnDeath = false
        humanoid:SetStateEnabled(Enum.HumanoidStateType.Dead, false)

        humanoid:GetPropertyChangedSignal("Health"):Connect(function()
            if humanoid.Health <= 0 then
                humanoid.Health = humanoid.MaxHealth
            end
        end)

        humanoid.Died:Connect(function()
            task.wait()
            local replacement = Instance.new("Humanoid")
            replacement.Name = "ReplacedHumanoid"
            replacement.Parent = character
            workspace.CurrentCamera.CameraSubject = replacement
            humanoid:Destroy()
        end)
    end

    local function disableAntiDie()
        if not antiDieActive then return end
        antiDieActive = false
        btnAntiDie.Text = "ANTI-DIE"
        btnAntiDie.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        local character = LocalPlayer.Character
        if character then
            local humanoid = character:FindFirstChildOfClass("Humanoid")
            if humanoid then
                humanoid.BreakJointsOnDeath = true
                humanoid:SetStateEnabled(Enum.HumanoidStateType.Dead, true)
            end
        end
    end

    local function toggleAfkHide()
        if not afkHideActive then
            if enableRigSwap() then
                afkHideActive = true
                btnAfkHide.Text = "AFK HIDE BRAINROT (ON)"
                btnAfkHide.BackgroundColor3 = Color3.fromRGB(80, 20, 20)
                enableAntiDie()
            end
        else
            disableRigSwap()
            afkHideActive = false
            btnAfkHide.Text = "AFK HIDE BRAINROT"
            btnAfkHide.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            disableAntiDie()
        end
    end

    local hidePulseActive = false
    local function toggleHideBrainrot()
        if not hideBrainrotActive then
            if enableRigSwap() then
                hideBrainrotActive = true
                hidePulseActive = true
                btnHideBrainrot.Text = "HIDE BRAINROT (ON)"
                btnHideBrainrot.BackgroundColor3 = Color3.fromRGB(80, 20, 20)
                enableAntiDie()
                task.spawn(function()
                    while hidePulseActive do
                        task.wait(2.75)
                        if not hidePulseActive then break end
                        disableRigSwap()
                        task.wait(0.85)
                        if not hidePulseActive then break end
                        if hideBrainrotActive then
                            enableRigSwap()
                        end
                    end
                end)
            end
        else
            hidePulseActive = false
            disableRigSwap()
            hideBrainrotActive = false
            btnHideBrainrot.Text = "HIDE BRAINROT"
            btnHideBrainrot.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            disableAntiDie()
        end
    end

    local function toggleFloatUp()
        floatUpActive = not floatUpActive
        if floatUpActive then
            btnFloatUp.Text = "FLOAT UP (ON)"
            btnFloatUp.BackgroundColor3 = Color3.fromRGB(80, 20, 20)

            local character = LocalPlayer.Character
            if not character then return end
            local hrp = character:FindFirstChild("HumanoidRootPart")
            if not hrp then return end

            local platform = Instance.new("Part")
            platform.Name = "WavaPlatform"
            platform.Size = Vector3.new(10, 1, 10)
            platform.Position = hrp.Position - Vector3.new(0, 3, 0)
            platform.Anchored = true
            platform.CanCollide = true
            platform.Material = Enum.Material.Neon
            platform.BrickColor = BrickColor.new("Really black")
            platform.Transparency = 0.4
            platform.Parent = workspace

            local topGui = Instance.new("SurfaceGui")
            topGui.Face = Enum.NormalId.Top
            topGui.AlwaysOnTop = true
            topGui.Parent = platform

            local topFrame = Instance.new("Frame")
            topFrame.Size = UDim2.new(1, 0, 1, 0)
            topFrame.BackgroundTransparency = 1
            topFrame.Parent = topGui

            local ring = Instance.new("UIStroke")
            ring.Thickness = 4
            ring.Color = Color3.new(1, 0, 0)
            ring.Parent = topFrame

            local hue = 0
            local step = 0.02
            local bob = 0.1

            floatUpConn = RunService.Heartbeat:Connect(function()
                if not platform or not platform.Parent then return end
                hue = (hue + step) % 1
                ring.Color = Color3.fromHSV(hue, 1, 1)

                local c = LocalPlayer.Character
                if c and c:FindFirstChild("HumanoidRootPart") then
                    local hum = c:FindFirstChildOfClass("Humanoid")
                    if hum then
                        local underPos = c.HumanoidRootPart.Position - Vector3.new(0, hum.HipHeight + 2, 0)
                        platform.Position = Vector3.new(underPos.X, (platform.Position + Vector3.new(0, bob, 0)).Y, underPos.Z)
                    end
                end
            end)
        else
            btnFloatUp.Text = "FLOAT UP"
            btnFloatUp.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            if floatUpConn then floatUpConn:Disconnect(); floatUpConn = nil end
            local p = workspace:FindFirstChild("WavaPlatform")
            if p then p:Destroy() end
        end
    end

    local function toggleFloatFall()
        floatFallActive = not floatFallActive
        if floatFallActive then
            btnFloatFall.Text = "FLOAT FALL (ON)"
            btnFloatFall.BackgroundColor3 = Color3.fromRGB(80, 20, 20)

            local character = LocalPlayer.Character
            if not character then return end
            local hum = character:FindFirstChildOfClass("Humanoid")
            local hrp = character:FindFirstChild("HumanoidRootPart")
            if hum and hrp then
                hum:ChangeState(Enum.HumanoidStateType.Jumping)
                floatFallConn = RunService.Heartbeat:Connect(function()
                    if floatFallActive and hrp then
                        hrp.Velocity = Vector3.new(hrp.Velocity.X, 0, hrp.Velocity.Z)
                    end
                end)
            end
        else
            btnFloatFall.Text = "FLOAT FALL"
            btnFloatFall.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            if floatFallConn then floatFallConn:Disconnect(); floatFallConn = nil end
        end
    end

    local function toggleLockReminder()
        lockReminderActive = not lockReminderActive
        if lockReminderActive then
            btnLockReminder.Text = "LOCK TIMER REMINDER (ON)"
            btnLockReminder.BackgroundColor3 = Color3.fromRGB(80, 20, 20)
            local running = true
            reminderThread = task.spawn(function()
                while running do
                    task.wait(25)
                    if not running then break end
                    local g = Instance.new("ScreenGui")
                    g.ResetOnSpawn = false
                    g.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
                    g.Parent = CoreGui
                    local f = Instance.new("Frame")
                    f.Size = UDim2.new(0, 250, 0, 50)
                    f.Position = UDim2.new(0, 10, 0, 10)
                    f.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
                    f.BorderSizePixel = 0
                    f.Parent = g
                    Instance.new("UICorner", f)
                    local lbl = Instance.new("TextLabel")
                    lbl.Size = UDim2.new(1, 0, 1, 0)
                    lbl.Text = "REMINDER! LOCK UR BASE"
                    lbl.TextColor3 = Color3.fromRGB(255, 255, 255)
                    lbl.BackgroundTransparency = 1
                    lbl.Font = Enum.Font.GothamBold
                    lbl.TextSize = 14
                    lbl.Parent = f
                    task.wait(3)
                    g:Destroy()
                end
            end)

            btnLockReminder:SetAttribute("StopFlag", function() running = false end)
        else
            btnLockReminder.Text = "LOCK TIMER REMINDER"
            btnLockReminder.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            local stopper = btnLockReminder:GetAttribute("StopFlag")
            if stopper then stopper() end
            btnLockReminder:SetAttribute("StopFlag", nil)
        end
    end

    local function openDesyncGUI()
        local playerGui = LocalPlayer:WaitForChild("PlayerGui")
        local desyncGui = Instance.new("ScreenGui")
        desyncGui.Name = "WavaHubPremium"
        desyncGui.ResetOnSpawn = false
        desyncGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
        desyncGui.Parent = playerGui

        local frame = Instance.new("Frame")
        frame.Name = "MainFrame"
        frame.Size = UDim2.new(0, 200, 0, 100)
        frame.Position = UDim2.new(1, -210, 0, 10)
        frame.BackgroundColor3 = Color3.fromRGB(5, 5, 5)
        frame.BorderSizePixel = 0
        frame.Active = true
        frame.Parent = desyncGui

        local corner = Instance.new("UICorner"); corner.CornerRadius = UDim.new(0, 16); corner.Parent = frame
        local stroke = Instance.new("UIStroke"); stroke.Color = Color3.fromRGB(50,50,50); stroke.Thickness = 1; stroke.Transparency = 0.2; stroke.Parent = frame

        local header2 = Instance.new("Frame")
        header2.Name = "Header"
        header2.Size = UDim2.new(1, 0, 0, 40)
        header2.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
        header2.BorderSizePixel = 0
        header2.Parent = frame
        local corner2 = Instance.new("UICorner"); corner2.CornerRadius = UDim.new(0, 16); corner2.Parent = header2

        local title2 = Instance.new("TextLabel")
        title2.Name = "TitleLabel"
        title2.Size = UDim2.new(1, -50, 1, 0)
        title2.Position = UDim2.new(0, 16, 0, 0)
        title2.BackgroundTransparency = 1
        title2.Text = "t.me/deltascriptt | WAVA HUB"
        title2.TextColor3 = Color3.fromRGB(255, 255, 255)
        title2.TextSize = 14
        title2.TextXAlignment = Enum.TextXAlignment.Left
        title2.Font = Enum.Font.GothamBold
        title2.Parent = header2

        local title2Shadow = Instance.new("TextLabel")
        title2Shadow.Size = UDim2.new(1, -50, 1, 0)
        title2Shadow.Position = UDim2.new(0, 17, 0, 1)
        title2Shadow.BackgroundTransparency = 1
        title2Shadow.TextColor3 = Color3.fromRGB(0, 0, 0)
        title2Shadow.TextTransparency = 0.7
        title2Shadow.Text = "t.me/deltascriptt | WAVA HUB"
        title2Shadow.Font = Enum.Font.GothamBold
        title2Shadow.TextSize = 14
        title2Shadow.TextXAlignment = Enum.TextXAlignment.Left
        title2Shadow.ZIndex = title2.ZIndex - 1
        title2Shadow.Parent = header2
        local title2Stroke = Instance.new("UIStroke"); title2Stroke.Color = Color3.fromRGB(0,0,0); title2Stroke.Transparency = 0.5; title2Stroke.Parent = title2

        local close2 = Instance.new("TextButton")
        close2.Name = "CloseButton"
        close2.Size = UDim2.new(0, 32, 0, 32)
        close2.Position = UDim2.new(1, -36, 0, 4)
        close2.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
        close2.BorderSizePixel = 0
        close2.Text = "X"
        close2.TextColor3 = Color3.fromRGB(255, 255, 255)
        close2.TextSize = 14
        close2.Font = Enum.Font.GothamBold
        close2.Parent = header2

        close2.MouseEnter:Connect(function()
            TweenService:Create(close2, TweenInfo.new(0.2, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
                BackgroundColor3 = Color3.fromRGB(255, 255, 255),
                TextColor3 = Color3.fromRGB(0, 0, 0),
                Size = UDim2.new(0, 34, 0, 34),
            }):Play()
        end)
        close2.MouseLeave:Connect(function()
            TweenService:Create(close2, TweenInfo.new(0.2, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
                BackgroundColor3 = Color3.fromRGB(15, 15, 15),
                TextColor3 = Color3.fromRGB(255, 255, 255),
                Size = UDim2.new(0, 32, 0, 32),
            }):Play()
        end)
        close2.MouseButton1Click:Connect(function()
            local tw = TweenService:Create(frame, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In), {
                Size = UDim2.new(0, 0, 0, 0),
                Position = UDim2.new(0.5, 0, 0.5, 0),
            })
            tw:Play()
            tw.Completed:Connect(function() desyncGui:Destroy() end)
        end)

        local content2 = Instance.new("Frame")
        content2.Name = "Content"
        content2.Size = UDim2.new(1, -24, 1, -48)
        content2.Position = UDim2.new(0, 12, 0, 44)
        content2.BackgroundTransparency = 1
        content2.Parent = frame

        local desyncBtn = Instance.new("TextButton")
        desyncBtn.Name = "DesyncButton"
        desyncBtn.Size = UDim2.new(1, 0, 0, 40)
        desyncBtn.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
        desyncBtn.BorderSizePixel = 0
        desyncBtn.Text = ""
        desyncBtn.Parent = content2
        local desyncCorner = Instance.new("UICorner"); desyncCorner.CornerRadius = UDim.new(0, 12); desyncCorner.Parent = desyncBtn
        local desyncStroke = Instance.new("UIStroke"); desyncStroke.Color = Color3.fromRGB(50, 50, 50); desyncStroke.Thickness = 1; desyncStroke.Transparency = 0.7; desyncStroke.Parent = desyncBtn

        local inner = Instance.new("Frame")
        inner.Size = UDim2.new(1, -24, 1, 0)
        inner.Position = UDim2.new(0, 12, 0, 0)
        inner.BackgroundTransparency = 1
        inner.Parent = desyncBtn

        local btnLabel = Instance.new("TextLabel")
        btnLabel.Name = "ButtonLabel"
        btnLabel.Size = UDim2.new(1, -60, 1, 0)
        btnLabel.BackgroundTransparency = 1
        btnLabel.Text = "Wava Desync"
        btnLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
        btnLabel.TextSize = 14
        btnLabel.TextXAlignment = Enum.TextXAlignment.Left
        btnLabel.Font = Enum.Font.GothamMedium
        btnLabel.Parent = inner

        local toggleSwitch = Instance.new("Frame")
        toggleSwitch.Name = "ToggleSwitch"
        toggleSwitch.Size = UDim2.new(0, 48, 0, 24)
        toggleSwitch.Position = UDim2.new(1, -48, 0.5, -12)
        toggleSwitch.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        toggleSwitch.BorderSizePixel = 0
        toggleSwitch.Parent = inner
        Instance.new("UICorner", toggleSwitch)

        local toggleKnob = Instance.new("Frame")
        toggleKnob.Name = "ToggleKnob"
        toggleKnob.Size = UDim2.new(0, 20, 0, 20)
        toggleKnob.Position = UDim2.new(0, 2, 0, 2)
        toggleKnob.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        toggleKnob.BorderSizePixel = 0
        toggleKnob.Parent = toggleSwitch
        Instance.new("UICorner", toggleKnob)

        local desyncOn = false
        local function updateToggle()
            if desyncOn then
                TweenService:Create(toggleSwitch, TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
                    BackgroundColor3 = Color3.fromRGB(255, 255, 255)
                }):Play()
                TweenService:Create(toggleKnob, TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
                    Position = UDim2.new(1, -22, 0, 2),
                    BackgroundColor3 = Color3.fromRGB(0, 0, 0)
                }):Play()
            else
                TweenService:Create(toggleSwitch, TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
                    BackgroundColor3 = Color3.fromRGB(40, 40, 40)
                }):Play()
                TweenService:Create(toggleKnob, TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
                    Position = UDim2.new(0, 2, 0, 2),
                    BackgroundColor3 = Color3.fromRGB(255, 255, 255)
                }):Play()
            end
        end

        local function tryEnableDesync()
            local success = pcall(function()
                local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
                local backpack = LocalPlayer:WaitForChild("Backpack")
                local humanoid = character:WaitForChild("Humanoid")

                local equippedTool = character:FindFirstChildOfClass("Tool")
                if not equippedTool then
                    warn("No equipped tool found. Desync requires an equipped tool; not auto-equipping.")
                    return false
                end

            local packages = game:GetService("ReplicatedStorage"):FindFirstChild("Packages")
                local net = packages and packages:FindFirstChild("Net")
                local useItem = net and net:FindFirstChild("RE/UseItem")
                local qCloneTeleport = net and net:FindFirstChild("RE/QuantumCloner/OnTeleport")

                if setfflag then
                    setfflag("WorldStepMax", "-9999999999")
                end

                task.wait(0.2)
                if useItem and useItem.FireServer then useItem:FireServer() end
                task.wait(1)
                if qCloneTeleport and qCloneTeleport.FireServer then qCloneTeleport:FireServer() end
                task.wait(2)
                if setfflag then setfflag("WorldStepMax", "-1") end
                return true
            end)
            return success
        end

        desyncBtn.MouseEnter:Connect(function()
            TweenService:Create(desyncStroke, TweenInfo.new(0.2, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
                Transparency = 0.3
            }):Play()
        end)
        desyncBtn.MouseLeave:Connect(function()
            TweenService:Create(desyncStroke, TweenInfo.new(0.2, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
                Transparency = 0.7
            }):Play()
        end)

        desyncBtn.MouseButton1Click:Connect(function()
            desyncOn = not desyncOn
            updateToggle()
            if desyncOn then
                if not tryEnableDesync() then
                    desyncOn = false
                    updateToggle()
                end
            else
                pcall(function()
                    if setfflag then setfflag("WorldStepMax", "-1") end
                end)
            end
        end)

        frame.Size = UDim2.new(0, 0, 0, 0)
        frame.Position = UDim2.new(0.5, 0, 0.5, 0)
        TweenService:Create(frame, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
            Size = UDim2.new(0, 200, 0, 100),
            Position = UDim2.new(1, -210, 0, 10),
        }):Play()

        LocalPlayer.CharacterAdded:Connect(function()
            desyncOn = false
            updateToggle()
        end)
    end

    closeBtn.MouseButton1Click:Connect(function()
        local tw = TweenService:Create(mainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In), {
            Size = UDim2.new(0, 0, 0, 0),
            Position = UDim2.new(0.5, 0, 0.5, 0),
        })
        tw:Play()
        tw.Completed:Connect(function()
            screenGui:Destroy()
        end)
    end)

    local minimized = false
    minimizeBtn.MouseButton1Click:Connect(function()
        local info = TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.InOut)
        minimized = not minimized
        if minimized then
            title.Text = "t.me/deltascriptt | WAVA"
            titleShadow.Text = "t.me/deltascriptt | WAVA"
            content.Visible = false
            sidebar.Visible = false
            divider.Visible = false
            TweenService:Create(mainFrame, info, {
                Size = UDim2.new(0, 200, 0, 50),
                Position = UDim2.new(mainFrame.Position.X.Scale, mainFrame.Position.X.Offset, mainFrame.Position.Y.Scale, mainFrame.Position.Y.Offset),
            }):Play()
        else
            title.Text = "t.me/deltascriptt | WAVA HUB"
            titleShadow.Text = "t.me/deltascriptt | WAVA HUB"
            content.Visible = true
            sidebar.Visible = true
            divider.Visible = true
            TweenService:Create(mainFrame, info, {
                Size = UDim2.new(0, 280, 0, 200),
                Position = UDim2.new(mainFrame.Position.X.Scale, mainFrame.Position.X.Offset, mainFrame.Position.Y.Scale, mainFrame.Position.Y.Offset),
            }):Play()
        end
    end)

    -- Connect buttons to functions
    btnPlayerESP.MouseButton1Click:Connect(toggleESP)
    btnAntiDie.MouseButton1Click:Connect(function() if antiDieActive then disableAntiDie() else enableAntiDie() end end)
    btnAfkHide.MouseButton1Click:Connect(toggleAfkHide)
    btnHideBrainrot.MouseButton1Click:Connect(toggleHideBrainrot)
    btnFloatUp.MouseButton1Click:Connect(toggleFloatUp)
    btnFloatFall.MouseButton1Click:Connect(toggleFloatFall)
    btnLockReminder.MouseButton1Click:Connect(toggleLockReminder)
    btnDesync.MouseButton1Click:Connect(openDesyncGUI)

    -- Detect current plot name
    local myPlotName = nil
    for _, plot in ipairs(workspace.Plots:GetChildren()) do
        local yourBase = plot:FindFirstChild("YourBase", true)
        if yourBase and yourBase.Enabled then
            myPlotName = plot.Name
            break
        end
    end
end)

if not ok then
    warn("Script failed to initialize: " .. tostring(initErr))
end
